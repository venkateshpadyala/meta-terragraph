"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1912],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),k=d(n),u=r,g=k["".concat(s,".").concat(u)]||k[u]||m[u]||l;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=k;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},1422:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const l={},i="Stats, Events, Logs",o={unversionedId:"developer/Stats_Events_Logs",id:"developer/Stats_Events_Logs",title:"Stats, Events, Logs",description:"This document describes Terragraph's monitoring infrastructure for pushing",source:"@site/../docs/developer/Stats_Events_Logs.md",sourceDirName:"developer",slug:"/developer/Stats_Events_Logs",permalink:"/docs/developer/Stats_Events_Logs",draft:!1,editUrl:"https://github.com/terragraph/meta-terragraph/edit/main/docs/../docs/developer/Stats_Events_Logs.md",tags:[],version:"current",frontMatter:{},sidebar:"developerManualSidebar",previous:{title:"Topology Discovery",permalink:"/docs/developer/Topology_Discovery"},next:{title:"Terragraph CLI",permalink:"/docs/developer/Terragraph_CLI"}},s={},d=[{value:"Collection",id:"collection",level:2},{value:"Stats Agent",id:"stats-agent",level:3},{value:"Fluent Bit",id:"fluent-bit",level:3},{value:"Logtail",id:"logtail",level:3},{value:"SNMP",id:"snmp",level:3},{value:"Aggregation",id:"aggregation",level:2},{value:"Kafka",id:"kafka",level:3},{value:"Fluentd",id:"fluentd",level:3},{value:"NMS Aggregator",id:"nms-aggregator",level:3},{value:"Stats",id:"stats",level:4},{value:"Events",id:"events",level:4},{value:"Logs",id:"logs",level:4},{value:"Common Stats",id:"common-stats",level:2},{value:"Resources",id:"resources",level:2}],p={toc:d};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"stats-events-logs"},"Stats, Events, Logs"),(0,r.kt)("p",null,"This document describes Terragraph's monitoring infrastructure for pushing\nnetwork stats, events, and logs."),(0,r.kt)("h2",{id:"collection"},"Collection"),(0,r.kt)("p",null,"This section describes the services which collect and export data."),(0,r.kt)("h3",{id:"stats-agent"},"Stats Agent"),(0,r.kt)("p",null,"Terragraph nodes utilize the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZmqMonitor")," feature of ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/facebook/fbzmq"},"fbzmq")," to collect stats\nand events. ",(0,r.kt)("inlineCode",{parentName:"p"},"ZmqMonitor")," provides a submit port (a ZMQ router socket) to which\ndifferent system components can send generated stats. It also provides a publish\nport to which multiple consumers can listen and receive updates on generated\nstats and events. Apps generating stats can use ",(0,r.kt)("inlineCode",{parentName:"p"},"ZmqMonitorClient")," to easily\ninject stats into ",(0,r.kt)("inlineCode",{parentName:"p"},"ZmqMonitor"),". Stat keys have arbitrary names, generally with\nperiod (",(0,r.kt)("inlineCode",{parentName:"p"},"."),") delimiters; stats published from ",(0,r.kt)("inlineCode",{parentName:"p"},"driver-if")," may also contain a\nnull character (",(0,r.kt)("inlineCode",{parentName:"p"},"\\0"),") delimiter followed by the originating radio MAC address.\nThe Thrift type for stats is ",(0,r.kt)("inlineCode",{parentName:"p"},"fbzmq::thrift::MonitorPub")," (defined in\n",(0,r.kt)("inlineCode",{parentName:"p"},"Monitor.thrift"),"), with a ",(0,r.kt)("inlineCode",{parentName:"p"},"pubType")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"fbzmq::thrift::PubType::COUNTER_PUB"),"."),(0,r.kt)("p",null,'Each node runs a dedicated "stats agent" process (',(0,r.kt)("inlineCode",{parentName:"p"},"stats_agent"),") which collects\nall generated stats and events via ",(0,r.kt)("inlineCode",{parentName:"p"},"ZmqMonitor")," and periodically publishes them\nto configured external endpoints. The stats agent uses the node ID (MAC address)\nas its source entity. The controller also runs a stats agent instance for its\nstats and events (and uses a dummy MAC address as its source entity). On the\ncontroller, the stats agent reads the controller configuration file instead of\nthe node configuration file."),(0,r.kt)("p",null,"The stats agent subscribes to all sockets specified in the configuration under\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"statsAgentParams.sources")," key. By default, the stats agent listens to and\npublishes stats/events from the following sources:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Source"),(0,r.kt)("th",{parentName:"tr",align:null},"Publish ZMQ URL"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"controller")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tcp://localhost:28989"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"driver-if")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tcp://localhost:18990"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"minion")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tcp://localhost:18989"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"system")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tcp://localhost:18991"))))),(0,r.kt)("p",null,'The "system" source is a local ',(0,r.kt)("inlineCode",{parentName:"p"},"ZmqMonitor")," instance within the stats agent.\nThis is used by the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"LocalStatsFetcher")," thread to collect and push various system stats, such as\nVPP stats (when ",(0,r.kt)("inlineCode",{parentName:"li"},"envParams.DPDK_ENABLED")," is set), Open/R stats (when\n",(0,r.kt)("inlineCode",{parentName:"li"},"statsAgentParams.collectors.openrStatsEnabled")," is set), and various local\ncounters relating to network interfaces, processes, memory, CPU, etc. By\ndefault, the thread will collect stats every 30 seconds\n(",(0,r.kt)("inlineCode",{parentName:"li"},"statsAgentParams.collectors.systemStatsCollectionInterval"),"), but can be\nmodified based on the desired low or high frequency publishing intervals (see\nbelow)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"InputListener")," thread to push events sent directly to the stats agent (e.g.\n",(0,r.kt)("inlineCode",{parentName:"li"},"tg2 event")," CLI).")),(0,r.kt)("p",null,"There are three consumers of the same data within the stats agent:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"KafkaPublisher")," - Pushes the collected data to a given ",(0,r.kt)("a",{parentName:"li",href:"https://kafka.apache.org/"},"Kafka")," cluster. This\nis configured under the node configuration structure\n",(0,r.kt)("inlineCode",{parentName:"li"},"statsAgentParams.endpointParams.kafkaParams"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NmsPublisher")," - Pushes the collected data to the NMS aggregator. This service\nhas been deprecated in favor of Kafka, but can be manually enabled in the node\nconfiguration structure ",(0,r.kt)("inlineCode",{parentName:"li"},"statsAgentParams.endpointParams.nmsPublisherParams"),".\nStats and events are collectively sent in a ",(0,r.kt)("inlineCode",{parentName:"li"},"STATS_REPORT")," message, and a\nsmall set of whitelisted stats are sent more frequently in a\n",(0,r.kt)("inlineCode",{parentName:"li"},"HIGH_FREQUENCY_STATS_REPORT")," message (e.g. for real-time data during node\ninstallation and alignment)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"GraphPublisher")," - Pushes the collected data to Meta internal endpoints\n(Scribe, ODS, Pelican) for storage and analysis, and is disabled by default.")),(0,r.kt)("p",null,"The data format for counter-type (",(0,r.kt)("inlineCode",{parentName:"p"},"fbzmq::thrift::CounterValueType::COUNTER"),")\nstats is determined by the following node configuration fields, which must be\nconsistent across all nodes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"statsAgentParams.publisherParams.convertToRate")," - If set, counters will be\npublished as computed rates, otherwise they will be published as raw values\nwith field ",(0,r.kt)("inlineCode",{parentName:"li"},"isCounter = true"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"statsAgentParams.publisherParams.publishValueWithRate"),' - If this and\n"convertToRate" are both set, then 2 keys will be published for each counter:',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<key name>")," (",(0,r.kt)("inlineCode",{parentName:"li"},"isCounter = true"),") containing the raw value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<key name>.rate")," (",(0,r.kt)("inlineCode",{parentName:"li"},"isCounter = false"),") containing the computed rate")))),(0,r.kt)("p",null,"Events that were not successfully transmitted to a Kafka broker (by\n",(0,r.kt)("inlineCode",{parentName:"p"},"KafkaPublisher"),") or the NMS aggregator (by ",(0,r.kt)("inlineCode",{parentName:"p"},"NmsPublisher"),") are cached to\n",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp/events.json")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp/kafka_events.json"),", respectively, upon stats agent\nshutdown, and are loaded again during initialization. A watchdog script,\n",(0,r.kt)("inlineCode",{parentName:"p"},"persist_event_cache.sh"),", moves these cache files to ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/")," upon a graceful\nLinux shutdown."),(0,r.kt)("h3",{id:"fluent-bit"},"Fluent Bit"),(0,r.kt)("p",null,"Terragraph nodes can push log files to ",(0,r.kt)("a",{parentName:"p",href:"https://www.fluentd.org/"},"Fluentd")," servers via a ",(0,r.kt)("a",{parentName:"p",href:"https://fluentbit.io/"},"Fluent Bit"),"\nclient process (",(0,r.kt)("inlineCode",{parentName:"p"},"fluent-bit"),") when server endpoints are provided under the\n",(0,r.kt)("inlineCode",{parentName:"p"},"fluentdParams.endpoints")," node configuration structure. Where possible, logs are\ntagged with ",(0,r.kt)("inlineCode",{parentName:"p"},"mac_addr")," holding the node ID, and ",(0,r.kt)("inlineCode",{parentName:"p"},"node_name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"topology_name"),"\nas given in the controller's topology."),(0,r.kt)("p",null,"The set of log files is specified in the node configuration under the\n",(0,r.kt)("inlineCode",{parentName:"p"},"fluentdParams.sources")," structure, containing the following defaults (depending\non hardware type):"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Source"),(0,r.kt)("th",{parentName:"tr",align:null},"File"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kern"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/var/log/kern.log"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"e2e_minion"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/var/log/e2e_minion/current"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"openr"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/var/log/openr/current"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"fib_vpp"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/var/log/fib_vpp/current"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vpp"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/var/log/vpp/current"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vpp_vnet"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/var/log/vpp/vnet.log"))))),(0,r.kt)("h3",{id:"logtail"},"Logtail"),(0,r.kt)("p",null,'Each Terragraph node can run a "logtail" process (',(0,r.kt)("inlineCode",{parentName:"p"},"logtail"),") which tails a set\nof log files and publishes them to the central aggregator. This feature has been\ndeprecated in favor of Fluent Bit, but can be enabled via node configuration\nfield ",(0,r.kt)("inlineCode",{parentName:"p"},"envParams.LOGTAIL_ENABLED"),". Unlike the stats agent, logtail is not used\non the controller, and sends its MAC address to the aggregator (via\n",(0,r.kt)("inlineCode",{parentName:"p"},"LogPublisher"),") in every message (",(0,r.kt)("inlineCode",{parentName:"p"},"SYSLOG_REPORT"),"). The set of log files is\nspecified under the node configuration structure ",(0,r.kt)("inlineCode",{parentName:"p"},"logTailParams.sources"),", and\ncontains the same defaults as Fluent Bit."),(0,r.kt)("h3",{id:"snmp"},"SNMP"),(0,r.kt)("p",null,"When enabled via the node configuration field ",(0,r.kt)("inlineCode",{parentName:"p"},"envParams.SNMP_ENABLED"),",\nTerragraph nodes will run a ",(0,r.kt)("a",{parentName:"p",href:"http://www.net-snmp.org/"},"Net-SNMP")," (Simple Network Management Protocol)\ndaemon process (",(0,r.kt)("inlineCode",{parentName:"p"},"snmpd"),") alongside a Terragraph SNMP agent process\n(",(0,r.kt)("inlineCode",{parentName:"p"},"snmp_agent"),") which can be polled for statistics. The SNMP agent registers\n",(0,r.kt)("inlineCode",{parentName:"p"},"TERRAGRAPH-RADIO-MIB")," to handle all requests for the MIB (Management\nInformation Base). The MIB for Terragraph radio stats is located in\n",(0,r.kt)("inlineCode",{parentName:"p"},"src/terragraph-stats/src/mib"),"."),(0,r.kt)("h2",{id:"aggregation"},"Aggregation"),(0,r.kt)("p",null,"This section describes the services which aggregate data."),(0,r.kt)("h3",{id:"kafka"},"Kafka"),(0,r.kt)("p",null,"Data pushed to ",(0,r.kt)("a",{parentName:"p",href:"https://kafka.apache.org/"},"Kafka")," via ",(0,r.kt)("inlineCode",{parentName:"p"},"stats_agent")," (on nodes and the controller) can be\naccessed in ",(0,r.kt)("em",{parentName:"p"},"topics")," defined under the\n",(0,r.kt)("inlineCode",{parentName:"p"},"statsAgentParams.endpointParams.kafkaParams.topics")," node configuration\nstructure. The data in each topic is a string representing a JSON-serialized\nThrift structure. The default topic names and their data formats are given in\nthe table below."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Topic Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Data Format"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"events"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"thrift::Event"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hf_stats"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"thrift::AggrStat"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"stats"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"thrift::AggrStat"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"scan_results"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"thrift::ScanResultEventWrapper"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"iperf_results"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"thrift::IperfOutput"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ping_results"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"thrift::PingOutput"))))),(0,r.kt)("h3",{id:"fluentd"},"Fluentd"),(0,r.kt)("p",null,"Logs pushed to ",(0,r.kt)("a",{parentName:"p",href:"https://www.fluentd.org/"},"Fluentd")," servers via ",(0,r.kt)("inlineCode",{parentName:"p"},"fluent-bit")," (on nodes) are tagged with the\nvalue ",(0,r.kt)("inlineCode",{parentName:"p"},"log.node.<name>")," (where ",(0,r.kt)("inlineCode",{parentName:"p"},"<name>")," is the corresponding key from the node\nconfiguration structure ",(0,r.kt)("inlineCode",{parentName:"p"},"fluentdParams.sources"),") and may contain the following\nfields:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mac_addr"),(0,r.kt)("td",{parentName:"tr",align:null},"Node ID (MAC address)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node_name"),(0,r.kt)("td",{parentName:"tr",align:null},"Node name (from topology)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"topology_name"),(0,r.kt)("td",{parentName:"tr",align:null},"Topology name")))),(0,r.kt)("p",null,"Also note that certain application crash traces are sent as multiline logs."),(0,r.kt)("h3",{id:"nms-aggregator"},"NMS Aggregator"),(0,r.kt)("p",null,"When enabled, the central aggregator (",(0,r.kt)("inlineCode",{parentName:"p"},"nms_aggregator"),") receives stats, events,\nand logs from ",(0,r.kt)("inlineCode",{parentName:"p"},"stats_agent")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"logtail")," processes as described above. It\nperiodically pushes this data upstream via HTTP POST requests to endpoints\ndefined in the aggregator configuration file (under ",(0,r.kt)("inlineCode",{parentName:"p"},"dataEndpoints"),"):"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Category"),(0,r.kt)("th",{parentName:"tr",align:null},"Endpoint"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Stats"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"host")," + ",(0,r.kt)("inlineCode",{parentName:"td"},"statsWriterSuffix"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"High-frequency stats"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"host")," + ",(0,r.kt)("inlineCode",{parentName:"td"},"highFreqStatsWriterSuffix"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Events"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"host")," + ",(0,r.kt)("inlineCode",{parentName:"td"},"events_writer"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Logs"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"host")," + ",(0,r.kt)("inlineCode",{parentName:"td"},"logs_writer"))))),(0,r.kt)("p",null,"This data is pushed every 30 seconds (",(0,r.kt)("inlineCode",{parentName:"p"},"data_publish_interval_s"),") by default;\nhigh-frequency stats are pushed every 1 second\n(",(0,r.kt)("inlineCode",{parentName:"p"},"high_frequency_data_publish_interval_s"),")."),(0,r.kt)("p",null,"Data formats for each category are shown below."),(0,r.kt)("h4",{id:"stats"},"Stats"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "topology": {\n    "name": <topology name : string>,\n  },\n  "interval": <stats push interval (in seconds) : int>,\n  "agents": [\n    {\n      "mac": <source MAC address : string>,\n      "name": <source node name (or empty) : string>,\n      "site": <source node site (or empty) : string>,\n      "stats": [\n        {\n          "ts": <unix timestamp (microseconds) : long>,\n          "key": <key name : string>,\n          "value": <raw value or rate (for counters) : double>,\n        },\n        ... <more stats>\n      ]\n    },\n    ... <more nodes>\n  ]\n}\n')),(0,r.kt)("h4",{id:"events"},"Events"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "topology": {\n    "name": <topology name : string>,\n  },\n  "agents": [\n    {\n      "mac": <source MAC address : string>,\n      "name": <source node name (or empty) : string>,\n      "site": <source node site (or empty) : string>,\n      "events": [\n        {\n          "timestamp": <unix timestamp (seconds) : long>,\n          "source": <event source : string>,\n          "reason": <event description : string>,\n          "details": <JSON-formatted event details : string>,\n          "category": <event category : enum(thrift::EventCategory)>,\n          "eventId": <event ID : enum(thrift::EventId)>,\n          "level": <event level : enum(thrift::EventLevel)>,\n          "entity": <event entity : string>,\n          "nodeId": <source node ID (MAC address) : string>,\n          "topologyName": <topology name : string>,\n          "nodeName": <node name : string>\n        },\n        ... <more events>\n      ]\n    },\n    ... <more nodes>\n  ]\n}\n')),(0,r.kt)("p",null,'Sample "events" entry:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "timestamp": 1549494973,\n  "source": "minion-app-IGNITION_APP",\n  "reason": "Sending assoc request for neighbor 00:00:00:10:0b:4a",\n  "details": "{\\"linkStatusType\\":1,\\"responderMac\\":\\"00:00:00:10:0b:4a\\",\\"responderNodeType\\":2,\\"responderNodePolarity\\":2,\\"initiatorMac\\":\\"00:00:00:10:0b:44\\"}",\n  "category": 100,\n  "eventId": 102,\n  "level": 10,\n  "entity": "00:00:00:10:0b:44",\n  "nodeId": "00:00:00:10:0b:44",\n  "topologyName": "Lab F8 B",\n  "nodeName": "terra111.f5.tb.a404-if"\n}\n')),(0,r.kt)("p",null,"The list of event categories, IDs, and levels is defined in ",(0,r.kt)("inlineCode",{parentName:"p"},"Event.thrift"),"."),(0,r.kt)("p",null,"Events can be used to generate alarms, using event data in the following way:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eventId")," - shared for all directly associated events (e.g. link up/down)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"level")," - implicitly defines raising or clearing an alarm (e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"ERROR")," to\nraise and ",(0,r.kt)("inlineCode",{parentName:"li"},"INFO")," to clear)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," - an arbitrary string used to differentiate events with the same ID\n(e.g. node ID, link name)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nodeId")," - the node ID (MAC address) that the event/alarm should be associated\nwith"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"nodeName")," - the node name associated with the node ID")),(0,r.kt)("h4",{id:"logs"},"Logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "topology": {\n    "name": <topology name : string>,\n  },\n  "agents": [\n    {\n      "mac": <source MAC address : string>,\n      "name": <source node name (or empty) : string>,\n      "site": <source node site (or empty) : string>,\n      "logs": [\n        {\n          "ts": <unix timestamp (microseconds) : long>,\n          "file": <file name : string>,\n          "log": <log line : string>,\n        },\n        ... <more logs>\n      ]\n    },\n    ... <more nodes>\n  ]\n}\n')),(0,r.kt)("h2",{id:"common-stats"},"Common Stats"),(0,r.kt)("p",null,"Some common stat formats are shown in the table below."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Prefix"),(0,r.kt)("th",{parentName:"tr",align:null},"Format"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"TG Firmware"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.<key name>")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.00:00:00:10:0b:40.staPkt.mcs"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"TG Driver"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgd")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgd.<key name>")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgd.gpsStat.fixNumSat"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Network Counters"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.<key name>")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.00:00:00:10:0b:40.tx_bytes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP Counters"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp")),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.00:00:00:10:0b:40.if.tx.pkts"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Process Counters"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<process name>")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<process name>.<key name>")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"e2e_minion.mem.util"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"System Counters"),(0,r.kt)("td",{parentName:"tr",align:null},"none"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"<key name>")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"uptime"))))),(0,r.kt)("p",null,"Specific keys are shown in the following table. Refer to\n",(0,r.kt)("a",{parentName:"p",href:"/docs/developer/Firmware_Stats"},"Firmware Stats")," for a full list of stats exported by\nTerragraph firmware."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Format"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"RSSI (received signal strength indicator)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.phystatus.srssi"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SNR (signal-to-noise ratio)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.phystatus.ssnrEst"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MCS index"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.mcs"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PER (packet error rate)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.perE6"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Mgmt link up count"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.mgmtLinkUp"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Mgmt link available count"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.linkAvailable"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Received packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.rxOk"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Successful MPDUs"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.txOk"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Failed MPDUs"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.txFail"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit power"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.staPkt.txPowerIndex"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit beam index"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.phyperiodic.txbeamidx"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive beam index"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tgf.<remote MAC address>.phyperiodic.rxbeamidx"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit bytes"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.tx_bytes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive bytes"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.rx_bytes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.tx_packets"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.rx_packets"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit errors"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.tx_errors"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive errors"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.rx_errors"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit dropped"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.tx_dropped"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive dropped"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.rx_dropped"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive frame"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.rx_frame"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Receive overruns"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.rx_overruns"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit overruns"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.tx_overruns"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Transmit collisions"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.tx_collisions"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Interface speed (mbps)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"link.<remote MAC address>.speed"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP transmit bytes"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.tx.bytes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP receive bytes"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.rx.bytes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP transmit packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.tx.pkts"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP receive packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.rx.pkts"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP transmit error packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.tx-error.pkts"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP receive error packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.rx-error.pkts"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP dropped packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.if.drops.pkts"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP QoS bytes"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.qos.tc<N>.bytes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP QoS bytes dropped"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.qos.tc<N>.bytes_dropped"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP QoS packets"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.qos.tc<N>.packets"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VPP QoS packets dropped"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"vpp.<remote MAC address>.qos.tc<N>.packets_dropped"))))),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/facebook/fbzmq"},"fbzmq")," - Meta's ZeroMQ wrappers"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kafka.apache.org/"},"Kafka")," - Distributed streaming platform"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.fluentd.org/"},"Fluentd")," - Log collector"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://fluentbit.io/"},"Fluent Bit")," - Log processor and forwarder"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://www.net-snmp.org/"},"Net-SNMP")," - Simple Network Management Protocol (SNMP) software suite")))}m.isMDXComponent=!0}}]);