<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer/Beamforming_Link_Adaptation">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Terragraph" href="/opensearch.xml">
<link rel="stylesheet" href="/katex/katex.min.css"><title data-rh="true">Beamforming and Link Adaptation | Terragraph</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://terragraph.com/logo/terragraph-logo-full-RGB.png"><meta data-rh="true" name="twitter:image" content="https://terragraph.com/logo/terragraph-logo-full-RGB.png"><meta data-rh="true" property="og:url" content="https://terragraph.com/docs/developer/Beamforming_Link_Adaptation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Beamforming and Link Adaptation | Terragraph"><meta data-rh="true" name="description" content="Beamforming (BF) is the process of using signal propagation information between"><meta data-rh="true" property="og:description" content="Beamforming (BF) is the process of using signal propagation information between"><link data-rh="true" rel="icon" href="/logo/terragraph-logo-favicon-32x32-full-RGB.png"><link data-rh="true" rel="canonical" href="https://terragraph.com/docs/developer/Beamforming_Link_Adaptation"><link data-rh="true" rel="alternate" href="https://terragraph.com/docs/developer/Beamforming_Link_Adaptation" hreflang="en"><link data-rh="true" rel="alternate" href="https://terragraph.com/docs/developer/Beamforming_Link_Adaptation" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TB9T0CGM6Y-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.48218837.css">
<link rel="preload" href="/assets/js/runtime~main.ee1b3ecd.js" as="script">
<link rel="preload" href="/assets/js/main.feb34f19.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/terragraph-logo-favicon-32x32-full-RGB.svg" alt="Terragraph Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/logo/terragraph-logo-favicon-32x32-white-RGB.svg" alt="Terragraph Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/terragraph/meta-terragraph" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link githubButton navbarIconButton" title="GitHub"></a><a href="https://discord.gg/HQaxCevzus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link discordButton navbarIconButton" title="Discord"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/runbook">Runbook</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/developer">Developer Manual</a></li><li><a class="dropdown__link" href="/docs/whitepapers">Whitepapers</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/developer">Developer Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Communication_Protocol">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/developer/Beamforming_Link_Adaptation">Firmware Layer</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developer/Beamforming_Link_Adaptation">Beamforming and Link Adaptation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/MAC_PHY_Specification">MAC &amp; PHY Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/PHY_Algorithms">PHY Algorithms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Firmware_Stats">Firmware Stats</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Topology_Management">End-to-End (E2E) Service</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Stats_Events_Logs">Application Layer Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Service_Scripts">System Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Release_Conventions">Version Control</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer"><span itemprop="name">Developer Manual</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Firmware Layer</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Beamforming and Link Adaptation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Beamforming and Link Adaptation</h1><p>Beamforming (BF) is the process of using signal propagation information between
two antennas and modifying antenna characteristics to maximize the signal
quality between those antennas. The BF process accomplishes this in a few
discrete states, including passive acquisition, active signaling, and continuous
refinement.</p><p>This document describes the Terragraph beamforming procedures, messages, and
other information related to the beamforming process.</p><p>The <a href="#beamforming-link-adaptation-glossary">Glossary</a> collects the acronyms and
defines the terms used in this document.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="link-states-and-transitions">Link States and Transitions<a class="hash-link" href="#link-states-and-transitions" title="Direct link to heading">​</a></h2><p>A link represents the directional connectivity between a transmitter and a
receiver. The transmitter and receiver shall independently maintain the state of
the link. Conditions can exist where the state of a link as determined by the
transmitter differs from the state of the link as determined by the receiver.</p><p>There are five link states: <em>Link Down</em>, <em>Link Unstable</em>, <em>Link Acquisition</em>,
<em>Link Up</em>, and <em>Link Up with Simultaneous Reacquisition</em>. Figure 1 illustrates
these states and the transitions between them. This link state machine exists
independently for each link of a node.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig1_LinkStatesAndTransitions.png" width="512" class="img_ev3q"><br><em>Figure 1, Link States and Transitions</em></p><p>A link enters into a <em>Link Acquisition</em> state when an existing node in the
network and a new node perform the BF acquisition procedure to establish
connectivity with the network. After successful BF acquisition and association,
the link moves to the <em>Link Up</em> state. In the <em>Link Up</em> state, the node monitors
the link periodically and takes actions at the link level to operate the link at
the maximum throughput (link adaptation).</p><p>From the steady state, the node moves the link to the <em>Link Unstable</em> state,
whenever there is a packet error burst. In the <em>Link Unstable</em> state, the node
takes actions to resolve the error burst. The actions taken to attempt
resolution of the error burst include link adaptation, beam refinement, and beam
switching. Upon successful resolution, the link moves back to <em>Link Up</em> state.</p><p>If the node is unable to resolve the issue causing the link to be in the <em>Link
Unstable</em> state within the time allowed, the node moves the link to the <em>Link
Down</em> state. In the <em>Link Down</em> state, the node attempts several procedures to
revive the link. If the attempts are successful, the node moves the link back to
the <em>Link Up</em> state.</p><p>If the attempts to revive the link are not successful, the node moves the link
to the <em>Link Acquisition</em> state or the <em>Link Down</em> state. If the node is a DN,
the link moves to the <em>Link Down</em> state and the node waits for direction from
the E2E controller. If the node is a CN, the link moves to the <em>Link
Acquisition</em> state.</p><p>Table 1 summarizes the procedures associated with each link state and the
purpose of those procedures.</p><table><thead><tr><th><strong>Link State</strong></th><th><strong>Procedures</strong></th><th><strong>Purpose</strong></th></tr></thead><tbody><tr><td><em>Link Acquisition</em></td><td>Beamforming acquisition</td><td>Establish the link and determine a list of micro-routes</td></tr><tr><td><em>Link Up</em></td><td>1. Link adaptation</td><td>1. MCS adjustment</td></tr><tr><td></td><td>2. Micro-route order update</td><td>2. Micro-route order update (micro-route switching)</td></tr><tr><td></td><td>3. Beamforming reacquisition</td><td>3. Micro-route update (detect new micro-routes and remove nonexisting micro-routes</td></tr><tr><td><em>Link Up with Simultaneous Reacquisition</em></td><td>Beamforming reacquisition</td><td>Find list of micro-routes from neighboring nodes to perform interference management</td></tr><tr><td><em>Link Unstable</em></td><td>1. Link adaptation</td><td>1. MCS and transmit power adjustment</td></tr><tr><td></td><td>2. Micro-route update</td><td>2. Micro-route order update (micro-route switching)</td></tr><tr><td></td><td>3. DN handoff</td><td></td></tr><tr><td><em>Link Down</em></td><td>1. Unilateral beam switching (Basic)</td><td>1. Change to an existing backup micro-route</td></tr><tr><td></td><td>2. Transmit and receive mini-sweep (advanced)</td><td>2. Find an existing micro-route</td></tr><tr><td></td><td>3. DN handoff</td><td>3. Change to an existing micro-route with a micro-route with a different DN</td></tr><tr><td></td><td>4. Beamforming reacquisition</td><td>4. Acquire new micro-routes</td></tr></tbody></table><p><em>Table 1, Link States and Procedures</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-down-state">Link Down State<a class="hash-link" href="#link-down-state" title="Direct link to heading">​</a></h3><p>This is the initial state for the link. A node initializes the link information
and transitions to the <em>Link Acquisition</em> state as a responder.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-acquisition-state">Link Acquisition State<a class="hash-link" href="#link-acquisition-state" title="Direct link to heading">​</a></h3><p>A CN always performs the responder role during beamforming procedures in this
state. A DN enters the link acquisition state upon link initialization or when
directed by the E2E controller while in the <em>Link Down</em> state. The DN always
performs the responder role when entering the link acquisition state after link
initialization. The DN performs the initiator role only when directed to enter
this state by the E2E controller. After successfully completing the beamforming
acquisition procedure and association with the neighboring node, the link
transitions to the <em>Link Up</em> state.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-up-state">Link Up State<a class="hash-link" href="#link-up-state" title="Direct link to heading">​</a></h3><p>In this state, both DN and CN monitor the link quality for variations causing
decreased signal quality or increased packet error rate. Based on the variation
of signal quality or packet error rate, the node performs link adaptation or
micro-route reordering. Periodically, the node performs beamforming
reacquisition. On direction of the E2E controller, the node transitions to the
<em>Link Up</em> with Simultaneous Reacquisition state. On detection of a packet error
burst exceeding a preset error threshold for which link adaptation or
micro-route, reordering is unable to correct, the node transitions to the <em>Link
Unstable</em> state.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-up-with-simultaneous-reacquisition-state">Link Up with Simultaneous Reacquisition State<a class="hash-link" href="#link-up-with-simultaneous-reacquisition-state" title="Direct link to heading">​</a></h3><p>In this state, the node performs beamforming reacquisition under the direction
of the E2E controller. After completing the beamforming procedure, including the
exchange of new micro-route ordering, the node transitions to the <em>Link Up</em>
state.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-unstable-state">Link Unstable State<a class="hash-link" href="#link-unstable-state" title="Direct link to heading">​</a></h3><p>In this state, the node attempts to recover from rapid, dramatic increases in
packet error rate. If the node successfully completes the beamforming
acquisition procedure, the node exchanges micro-routes and transitions to the
<em>Link Up</em> state. If the node does not successfully complete the beamforming
acquisition procedure, the node transitions to the <em>Link Down</em> state.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-procedures">Beamforming Procedures<a class="hash-link" href="#beamforming-procedures" title="Direct link to heading">​</a></h2><p>The Terragraph MAC performs all beamforming procedures using the frames defined
in the <a href="/docs/developer/MAC_PHY_Specification">MAC &amp; PHY Specification</a>. The following
defines the beamforming procedures.</p><ul><li><strong>Beamforming Acquisition</strong> – discovery and establishment of all possible link
level connections (LLC, also referred to as &quot;micro-routes&quot;) between any two
nodes in the network</li><li><strong>Beamforming Re-acquisition</strong> – repopulation of the 2D LLC used for routing
on Layer 3 (L3); triggers periodically in the steady state, upon transition to
a catastrophic failure state, or add new node states</li><li><strong>Beamforming Refinement</strong> – fine adjustments to beamforming weights in the
steady state to maximize link quality based on a pre-established 2D LLC</li><li><strong>Micro-route Update</strong> – changing the prioritized list of micro-routes in
steady state based on changes in link quality and packet error rate</li><li><strong>Link Adaptation</strong> – changing the modulation and coding scheme (MCS) and or
transmit power to react to varying link conditions</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-acquisition-and-reacquisition">Beamforming Acquisition and Reacquisition<a class="hash-link" href="#beamforming-acquisition-and-reacquisition" title="Direct link to heading">​</a></h3><p>The beamforming acquisition and reacquisition procedures use MAC frame exchanges
between an initiator node and a responder node. The beamforming acquisition and
beamforming reacquisition procedures share similar workflows. This section
describes both of these procedures. Beamforming acquisition operates using
either the synchronous sweep or the asynchronous sweep at the responder.
Beamforming reacquisition operates only using the synchronous sweep.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-beamforming-sweep">Asynchronous Beamforming Sweep<a class="hash-link" href="#asynchronous-beamforming-sweep" title="Direct link to heading">​</a></h4><p>A node shall use an asynchronous sweep when the frame and slot boundary timing
is unknown. This condition can exist when a node has not yet received
synchronization information or when a link moves to the <em>Link Down</em> state and
previously acquired synchronization information has become stale. The purpose of
the asynchronous sweep is to establish initial communication between an
initiator node and responder node, as well as to synchronize the timing of the
responder node to that of the initiator node. Figure 2 shows the Asynchronous
sweep procedure.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig2_AsynchronousSweep.png" width="800" class="img_ev3q"><br><em>Figure 2, Asynchronous Sweep</em></p><p>When an initiator node attempts to perform beamforming acquisition or
reacquisition with a node with which it has not yet established synchrony or
with which the synchronization information has become stale, the initiator shall
transmit two consecutive <code>urTrnReq</code> frames, separated by the minimum interframe
gap, in each TDD frame. The two consecutive <code>urTrnReq</code> frames are a <code>urTrnReq</code>
frame doublet. The initiator shall sweep through all of the transmit beams,
repeating the same transmit beam index for <em>N-1</em> repetitions (31 or 61 for the
current implementation) of the two consecutive <code>urTrnReq</code> frames (2<em>N <code>urTrnReq</code>
frames with the same transmit beam index). After the </em>N-1*st repetition, the
initiator shall move to the next transmit beam index. The purpose of this is to
provide the responder node the maximum likelihood of correctly receiving and
decoding one of the <code>urTrnReq</code> frames.</p><p>The responder node, when it has not established synchrony with an initiator
node, shall sweep its receiver through every receive beam, dwelling on each
receive beam for a period of time equal to the minimum interframe time plus
twice the time to transmit the <code>urTrnReq</code> frame. At the end of the dwell time on
a receive beam, the responder shall continue to the next receive beam. The
responder shall loop through all receive beams, until successfully receiving and
decoding the <code>urTrnReq</code> frame.</p><p>Upon receipt of the <code>urTrnReq</code> frame, the responder shall synchronize its local
time, frame boundary and slot boundary to that of the initiator. After the
responder synchronizes with the initiator, the responder shall terminate the
asynchronous sweep and begin the synchronous sweep.</p><a id="beamforming-link-adaptation-synchronous-beamforming-sweep"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="synchronous-beamforming-sweep">Synchronous Beamforming Sweep<a class="hash-link" href="#synchronous-beamforming-sweep" title="Direct link to heading">​</a></h4><p>Synchronous beamforming acquisition and reacquisition are the processes of
exchanging frames between an initiator node and a responder node, exhaustively
attempting to find pairs of transmit beams from the initiator and receive beams
from the responder that allow reliable communication between the two nodes to
occur. A node shall use synchronous beamforming acquisition or reacquisition
only when the responder node synchronizes to the frame and slot boundaries of
the initiator node.</p><p>The acquisition and re-acquisition procedures involve testing <em>N_i</em> transmit and
<em>N_r</em> receive beam combinations. Figure 3 illustrates this procedure. The
procedure assumes link reciprocity. The initiator and responder shall send all
frames in the control slot, the first slot, of a frame.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig3_BeamformingTrainingFlow.png" width="700" class="img_ev3q"><br><em>Figure 3, Beamforming Training Flow Diagram</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="initiator-operation">Initiator Operation<a class="hash-link" href="#initiator-operation" title="Direct link to heading">​</a></h4><p>The initiator shall transmit two Beamforming Training Request (<code>urTrnReq</code>)
frames with a particular transmit beam index, separated by the minimum
interframe time (a <code>urTrnReq</code> doublet) to begin the procedure. The initiator
shall transmit the doublets in the first slot of the transmit subframe of each
frame. The initiator shall reserve the slots used to transmit the <code>urTrnReq</code> and
receive the <code>urTrnRes</code> frames in the slot maps exchanged with all other
associated nodes.</p><p>The initiator shall transmit the <code>urTrnReq</code> doublet for 31 consecutive TDD
frames. The value of <code>FrmNumInBfWin</code> in the <code>urTrnReq</code> frame indicates the
number of transmissions, minus 1. The initiator shall repeat the transmission of
the 31 <code>urTrnReq</code> doublets N times, with each repetition using a new transmit
beam index. The N repetitions allow the receiver to test all possible receive
beam indexes against that transmit beam index.</p><p>Fifteen TDD frames after the transmission of the last of the 31 <code>urTrnReq</code>
doublets for a transmit beam index, the initiator shall set the node&#x27;s receive
beam index to the value of the transmit beam index of the previously transmitted
<code>urTrnReq</code> doublets. This allows the initiator to receive any urTrnRes frame
returned from a responder.</p><p>Upon receipt of the urTrnRes frame, the initiator shall populate its 2D LLC
matrix for the corresponding transmit beam with the values returned by the
responder in the <code>urTrnRes</code> and shall send a Beamforming Training Response ACK
frame (<code>urTrnResAck</code>) using the transmit beam indicated as the <code>TxBeamIdx</code> of
the received <code>urTrnRes</code> frame. The initiator shall transmit the <code>urTrnResAck 15
TDD</code> frames after the receipt of the <code>urTrnRes</code> frame. If the initiator does not
receive the <code>urTrnRes</code> from the responder, the initiator shall not send the
<code>urTrnResAck</code> and shall populate its 2D LLC matrix with values indicating a lack
of response from the responder for the corresponding transmit beam.</p><p>The number of transmit beam indexes may differ between the beamforming
acquisition procedure and the beamforming reacquisition procedure. The
beamforming acquisition procedures shall use all possible transmit beam indexes.
The beamforming reacquisition procedure may use a subset of all of the transmit
beam indexes.</p><p>The initiator shall increment the transmit beam index and repeat the exchange of
<code>urTrnReq</code>, <code>urTrnRes</code>, and <code>urTrnResAck</code> frames for each transmit beam index,
until all indexes for the relevant procedure have been attempted. Because a
responder synchronizes with the initiator at a random point during the
initiator&#x27;s transmission of the <code>urTrnReq</code> doublets for the first transmit beam
for which the initiator receives the <code>urTrnRes</code>, the initiator shall repeat the
31 transmissions of the <code>urTrnReq</code> doublets for that same transmit beam after
completing the synchronous sweep for all other transmit beam indexes.</p><p>During the transmissions of the <code>urTrnReq</code> doublets with the final transmit beam
index of the sweep, the initiator shall set the <code>EndTrnFlag</code> in the frame to
indicate to the responder that this is the final set of transmit beam doublets.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="responder-operation">Responder Operation<a class="hash-link" href="#responder-operation" title="Direct link to heading">​</a></h4><p>The responder shall listen for urTrnReq frames in the first slot of the receive
subframe of each frame, noting the value of <code>FrmNumInBfWin</code> that indicates the
number of <code>urTrnReq</code> doublets transmitted with the same transmit beam index.
Fifteen TDD frames after the time at which the last <code>urTrnReq</code> frame was
transmitted, the responder shall send a Beamforming Training Response
(<code>urTrnRes</code>) frame, indicating the index of the transmit beam of the initiator
and the indexes and link quality of the receive beams for which the urTrnReq
frame was successfully decoded.</p><p>The responder shall send the <code>urTrnRes</code> frame using as the transmit beam the
beam index that has the greatest link quality indicated in the <code>urTrnRes</code> frame.
The responder shall send the <code>urTrnRes</code> frame in the first slot of the transmit
subframe.</p><p>The responder shall also track the value of <code>FrmNumInBfWin</code>, indicating how many
<code>urTrnReq</code> frame doublets the initiator transmitted with the same transmit beam
index. The responder shall send the <code>urTrnRes</code> frame 15 TDD frames after
synchronizing with the initiator and after the <code>FrmNumInBfWin</code> indicates the
last <code>urTrnReq</code> doublet with the same transmit beam index.</p><p>Upon receipt of the <code>urTrnResAck</code> frame, the responder shall populate its 2D LLC
matrix with the values from its sweep for the corresponding initiator transmit
beam. If the responder does not receive the <code>urTrnResAck</code>, it shall populate its
2D LLC matrix for the corresponding initiator transmit beam with a value
indicating a lack of response from the initiator.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="combined-initiator-and-responder-operation">Combined Initiator and Responder Operation<a class="hash-link" href="#combined-initiator-and-responder-operation" title="Direct link to heading">​</a></h4><p>When synchronized to the frame and slot boundaries of the initiator node, the
responder node shall use the synchronous sweep, as described in
<a href="#beamforming-link-adaptation-synchronous-beamforming-sweep">Synchronous Beamforming Sweep</a>.
Figure 4 shows the combined operation of the initiator and responder during the
synchronous sweep procedure.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig4_SynchronousSweep.png" width="1000" class="img_ev3q"><br><em>Figure 4, Synchronous Sweep</em></p><a id="beamforming-link-adaptation-micro-route-ordering-exchange"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="micro-route-ordering-exchange">Micro-route Ordering Exchange<a class="hash-link" href="#micro-route-ordering-exchange" title="Direct link to heading">​</a></h4><p>During the synchronous sweep exchanges, the initiator shall order the eight best
initiator transmit and responder receive beams, while the responder shall order
the eight best responder transmit and initiator receive beams, from the
information obtained during the synchronous sweep.</p><p>Upon completion of the synchronous sweep exchanges for all transmit beam
indexes, the responder shall send a Beamforming Micro-route Exchange (<code>urX</code>)
frame with the Beamforming Order Request (<code>urOrdReq</code>), listing the eight best
pairs of responder transmit and initiator receive beam indexes obtained from the
synchronous sweep. The responder shall send the <code>urX</code> frame in the first
available control slot to the initiator. The responder shall send this frame
using the transmit beam for which the initiator has indicated the best link
quality in any <code>urTrnResAck</code> frame. The responder shall send the <code>urX</code> frame in
the next available control slot.</p><p>After transmitting the <code>urX</code> frame with <code>urOrdReq</code>, the responder shall listen
for the <code>urX</code> frame from the initiator in the first available receive control
slot from the initiator using the receive beam index for which it has indicated
the best link quality in any <code>urTrnRes</code> frame.</p><p>Upon receipt of the <code>urX</code> frame from the responder, the initiator shall send the
<code>urX</code> frame with the Beamforming Order Response (<code>urOrdRes</code>), listing the eight
best pairs of initiator transmit and responder receive beam indexes obtained
from the synchronous sweep. The initiator shall send this frame using the
transmit beam for which it has received the best link quality indication in any
<code>urTrnRes</code> frame from the initiator. The initiator shall send the <code>urX</code> frame in
the first available control slot to the responder.</p><p>Figure 5 shows the end of the synchronous sweep and the micro-route exchange.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig5_MicroRouteFlow.png" width="1000" class="img_ev3q"><br><em>Figure 5, End of Synchronous Sweep and Micro-route Ordering Exchange</em></p><p align="center"><img loading="lazy" src="/figures/bf/ResponderFlow.png" width="512" class="img_ev3q"><br><em>Preliminary Responder State Diagram</em></p><p align="center"><img loading="lazy" src="/figures/bf/InitiatorFlow.png" width="512" class="img_ev3q"><br><em>Preliminary Initiator State Diagram</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="periodic-beamforming-scan">Periodic Beamforming Scan<a class="hash-link" href="#periodic-beamforming-scan" title="Direct link to heading">​</a></h3><p>The periodic beamforming scan (PBS) acquires fresh information about the
micro-routes between a single transmitter and a single receiver.</p><a id="beamforming-link-adaptation-pbs-procedure"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pbs-procedure">PBS Procedure<a class="hash-link" href="#pbs-procedure" title="Direct link to heading">​</a></h4><p>The E2E controller shall initiate the PBS by sending Scan Request Messages to
the transmitter/receiver node pair selected to perform the scan, called the
measurement set. Different from beamforming acquisition, PBS uniquely identifies
the transmitter and receiver to each other by their individual MAC addresses and
can indicate a subset of the micro-routes for scanning.</p><p>The MAC shall start the PBS at a bandwidth grant duration (BWGD) boundary
indicated in the Scan Request message. The duration of a PBS varies, dependent
on the number of beams scanned. This duration can be less than or greater than a
single BWGD.</p><p>For the duration of the scan, called the Beamforming Training Duration (BFTD),
the transmitter shall communicate slots reserved for beamforming to all
associated nodes in the normal slot map exchange. The transmitter shall send
<code>urTrnReq</code> training frames (see
<a href="/docs/developer/MAC_PHY_Specification">MAC &amp; PHY Specification</a> for frame details) for the
PBS only in the first transmit slot of each frame for the BFTD. The receiver
shall attempt to receive the transmitted training frames in the corresponding
receive slot.</p><p>The PBS proceeds unidirectionally, from the transmitter to the receiver. Unlike
synchronous beamforming, there is no exchange of <code>urTrnRes</code> or <code>urTrnResAck</code>
frames between the transmitter and receiver and no exchange of micro-routes,
<code>urX</code> frames, at the conclusion of the scan. The receiver sends feedback on the
scan to the controller, when the scan is complete, using the Scan Response
Message.</p><p>Figure 6 illustrates the PBS messaging exchange.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig6_PBS.png" width="1000" class="img_ev3q"><br><em>Figure 6, PBS Message Exchange</em></p><a id="beamforming-link-adaptation-pbs-scheduling"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pbs-scheduling">PBS Scheduling<a class="hash-link" href="#pbs-scheduling" title="Direct link to heading">​</a></h4><p>A scan of the beams selected for a PBS has a duration BFTD. The BFTD derives
from the number of transmit beams, the number of receive beams, and the BWGD.</p><p>The node shall calculate BFTD, in BWGDs, as shown in Equation 1.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>B</mi><mi>F</mi><mi>T</mi><mi>D</mi><mo>=</mo><mfrac><mrow><msub><mi>N</mi><mi>t</mi></msub><mo>×</mo><msub><mi>N</mi><mi>r</mi></msub></mrow><mrow><msub><mi>N</mi><mi>f</mi></msub><mo>×</mo><msub><mi>N</mi><mi>s</mi></msub></mrow></mfrac><mtext> </mtext><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">BFTD = \frac{N_{t} \times N_{r}}{N_{f} \times N_{s}}\ ,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.13889em">BFT</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.3324em;vertical-align:-0.9721em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace"> </span><span class="mpunct">,</span></span></span></span></span></div><p align="center"><em>Equation 1, Calculation of BTFD</em></p><p>where <em>N_t</em> is the number of transmit beams, <em>N_r</em> is the number of receive
beams, <em>N_f</em> is the number of frames in a superframe, and <em>N_s</em> is the number of
superframes in a BWGD. Figure 7 illustrates the calculation of the BFTD.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig7_BFTD.png" width="700" class="img_ev3q"><br><em>Figure 7, Beamforming Training Duration</em></p><p>The E2E controller shall schedule PBSs such that the duration of an individual
scan is significantly shorter than the period of the scans.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interference-measurement-scan">Interference Measurement Scan<a class="hash-link" href="#interference-measurement-scan" title="Direct link to heading">​</a></h3><p>The interference measurement scan (IMS) uses the PBS mechanism with additional
receivers to determine the interference caused by the transmissions of one
sector on other sectors. The E2E controller directs each IMS between one
transmit sector and one or more receive sectors in close geographic and/or
angular proximity. The sectors involved in an IMS do not necessarily have link
level connectivity. The sectors selected for the scan called, collectively, the
measurement set, perform the scan as directed by the E2E controller and report
the results back to the controller.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ims-procedure">IMS Procedure<a class="hash-link" href="#ims-procedure" title="Direct link to heading">​</a></h4><p>The E2E controller shall initiate an IMS by sending Scan Request Messages to the
transmitter node and receive nodes in the measurement set. When the measurement
set includes one or more CNs, the controller also shall send Scan Request
Messages to the DNs with which the CNs are associated. The nodes in the
measurement set shall start the IMS at the BWGD indicated in the Scan Request
Message. Each of the nodes in the measurement set will receive or create slot
maps reserving slots for beamforming, during which the nodes perform the IMS.
The IMS shall proceed as described in
<a href="#beamforming-link-adaptation-pbs-procedure">PBS Procedure</a>.</p><p>For the duration of the BFTD, the DNs in the measurement set shall communicate
slots reserved for beamforming to all associated nodes in the normal slot map
exchange. The transmitter shall send <code>urTrnReq</code> training frames (see
<a href="/docs/developer/MAC_PHY_Specification">MAC &amp; PHY Specification</a> for frame details) for the
IMS only in the first transmit slot of each frame for the BFTD. The <code>urTrnReq</code>
frames shall use the broadcast address as the destination address of the frame.
The receivers shall attempt to receive the transmitted training frames in the
corresponding receive slot.</p><p>The IMS proceeds unidirectionally, from the transmitter to the receivers. Unlike
synchronous beamforming, there is no exchange of <code>urTrnRes</code> or <code>urTrnResAck</code>
frames between the transmitter and receivers and no exchange of micro-routes,
<code>urX</code> frames, at the conclusion of the scan. The receivers send feedback on the
scan to the controller, when the scan is complete, using the Scan Response
Message.</p><p>Figure 8 illustrates the IMS messaging exchange.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig8_IMS.png" width="900" class="img_ev3q"><br><em>Figure 8, Interference Measurement Scan Message</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ims-scheduling-at-the-mac">IMS Scheduling at the MAC<a class="hash-link" href="#ims-scheduling-at-the-mac" title="Direct link to heading">​</a></h4><p>The node shall schedule the IMS as specified in
<a href="#beamforming-link-adaptation-pbs-scheduling">PBS Scheduling</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling-scans-at-the-network-level">Scheduling Scans at the Network Level<a class="hash-link" href="#scheduling-scans-at-the-network-level" title="Direct link to heading">​</a></h3><p>Individual PBS and IMS operations present little difficulty to schedule in an
operational network, as they consume relatively small amounts of bandwidth over
short periods. In a large network, however, it can be necessary to schedule
several scans to be operating at the same time. In order not to have one scan
interfere with another, it is necessary that a sector participate in only one
scan at a time; that is, a sector can be a member of only one measurement set
for which a scan is taking place. To facilitate the scheduling of parallel scans
in a network, the controller determines a sector adjacency matrix, a list of
measurement sets, and a scheduling exclusion matrix.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sector-adjacency-matrix">Sector Adjacency Matrix<a class="hash-link" href="#sector-adjacency-matrix" title="Direct link to heading">​</a></h4><p>The controller shall compute a sector adjacency matrix, where the elements in
the matrix indicate the possibility of the sectors interfering with one another.
The sector adjacency matrix is a square matrix with the dimensions equal to the
number of sectors in the network. Each element of the matrix,
<code>sector_adjacency_matrix(i,j)</code>, holds a binary value indicating that the sector
<em>i</em> is adjacent to sector <em>j</em>, in the sense that the sectors could cause
interference to one another. The controller can populate this matrix
conservatively, initially, based on deployment measurements of distance, angle,
and obstructions between sectors. As the controller conducts PBS and IMS, the
controller can prune the adjacencies from the matrix based on these
measurements.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="measurement-set-determination">Measurement Set Determination<a class="hash-link" href="#measurement-set-determination" title="Direct link to heading">​</a></h3><p>The controller determines a list measurement sets from the sector adjacency
matrix. Each element of the measurement set list holds the sectors of a unique
row of the sector adjacency matrix. The controller ignores duplicate rows of the
sector adjacency matrix, as they would produce a measurement set identical to
that derived from the row duplicated.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling-exclusion-matrix">Scheduling Exclusion Matrix<a class="hash-link" href="#scheduling-exclusion-matrix" title="Direct link to heading">​</a></h4><p>The controller shall compute a scheduling exclusion matrix, where the elements
of the matrix indicate whether two measurement sets contain any sectors in
common. The scheduling exclusion matrix is a square matrix with the dimensions
of the total number of measurement sets in the network. Each element of the
matrix, <code>scheduling_exclusion_matrix(i,j) = scheduling_exclusion_matrix(j,i)</code>
holds a binary value indicating that measurement set <em>i</em> contains at least one
sector in common with measurement set <em>j</em>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling-identifiers">Scheduling Identifiers<a class="hash-link" href="#scheduling-identifiers" title="Direct link to heading">​</a></h4><p>The controller creates a set of scheduling identifiers and assigns one or more
measurement sets to the identifier, such that all of the measurement sets with
the same scheduling identifier can conduct scans simultaneously. The controller
assigns scheduling identifiers to measurement sets using a graph vertex coloring
algorithm, where the vertices of the graph correspond to an individual
measurement set and the edges between vertices correspond to a scheduling
exclusion indicated in the scheduling exclusion matrix.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-adaptation-procedure">Link Adaptation Procedure<a class="hash-link" href="#link-adaptation-procedure" title="Direct link to heading">​</a></h3><p>The link adaptation procedure provides a method for a node to adjust the MCS and
transmit power of a link to maximize the throughput of that link.</p><p>If the link adaptation procedure is enabled and the control parameters for link
adaptation have been configured, a node shall perform the link adaptation
procedure for each of its links, while in the <em>Link Up</em> state. Out of band
management currently enables and configures the link adaptation procedure.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="receiver-operation">Receiver Operation<a class="hash-link" href="#receiver-operation" title="Direct link to heading">​</a></h4><p>The node shall measure the signal-to-noise ratio (SNR) of all received data
frames from each transmitter on a link. The node shall measure the received SNR
per transmitter over a minimum period of three superframes. The node shall
filter the received SNR per transmitter as shown in Equations 2, 3, and 4 to
create a set of link adaptation feedback parameters.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>AvgstfSNR</mtext><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mi>s</mi><mi>t</mi><mi>f</mi><mi>S</mi><mi>N</mi><mi>R</mi><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{AvgstfSNR} = \frac{1}{N}\sum_{k = 0}^{N - 1}{stfSNR\lbrack k\rbrack}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">AvgstfSNR</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3.1304em;vertical-align:-1.3021em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em"><span style="top:-1.8479em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal" style="margin-right:0.00773em">SNR</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">]</span></span></span></span></span></span></div><p align="center"><em>Equation 2, Average Short Term Feedback SNR</em></p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>AvgpostSNR</mtext><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi>S</mi><mi>N</mi><mi>R</mi><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{AvgpostSNR} = \frac{1}{N}\sum_{k = 0}^{N - 1}{postSNR\lbrack k\rbrack}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">AvgpostSNR</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3.1304em;vertical-align:-1.3021em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em"><span style="top:-1.8479em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mord mathnormal" style="margin-right:0.00773em">tSNR</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">]</span></span></span></span></span></span></div><p align="center"><em>Equation 3, Average Post SNR</em></p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>AvgRSSI</mtext><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mi>R</mi><mi>S</mi><mi>S</mi><mi>I</mi><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{AvgRSSI} = \frac{1}{N}\sum_{k = 0}^{N - 1}{RSSI\lbrack k\rbrack}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">AvgRSSI</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3.1304em;vertical-align:-1.3021em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em"><span style="top:-1.8479em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em">RSS</span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">]</span></span></span></span></span></span></div><p align="center"><em>Equation 4, Average Received Signal Strength Indication</em></p><p>The node shall send the link adaptation feedback parameters to the transmitter
in the Heartbeat, Keep Alive, and/or Uplink Bandwidth Request frames, as
appropriate for the types of node at each end of the link.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="transmitter-operation">Transmitter Operation<a class="hash-link" href="#transmitter-operation" title="Direct link to heading">​</a></h4><p>A node receiving the link adaptation feedback parameters may filter the
parameters to reduce instantaneous variability. The receiving node shall use the
link adaptation feedback parameters to choose a new MCS and/or transmit power
level, should the parameters indicate that a change is necessary to improve the
link throughput with the node sending the feedback parameters. The node also may
modify the choice of a new MCS and/or transmit power level using local
measurements of successful and unsuccessful frame transmissions, that is the
counts of frames for which the node receives acknowledgements and those for
which the node receives no acknowledgement. The node shall perform link
adaptation independently for each link on which it operates.</p><p>The outer loop link adaptation (OLLA) uses short-term frame statistics for total
number of frames sent, the number of frames received successfully and the number
of frames failed, along with the target error rate, the minimum and maximum
amounts to offset the signal-to-noise ratio (SNR), and the weight to apply to
failed frames (NACKWeight).</p><p>The inner loop of the algorithm uses the result of the outer loop computation to
offset the filtered SNR feedback from the receiving node to compute the
&quot;effective signal to interference and noise ratio (SINR)&quot;. The effective SINR
and offset select the MCS for future transmissions to the receiving node. Figure
9 illustrates the transmitter link adaptation algorithm.</p><p align="center"><img loading="lazy" src="/figures/bf/Fig9_TxLA.png" width="800" class="img_ev3q"><br><em>Figure 9, Transmitter Link Adaptation</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="transmit-power-control">Transmit Power Control<a class="hash-link" href="#transmit-power-control" title="Direct link to heading">​</a></h4><p>Terragraph nodes implement transmit power control (TPC) to balance two opposing
requirements. The first requirement is to maximize the utilization of each
transmit opportunity by using the highest MCS providing minimal error rates. The
second requirement is to minimize the interference caused by transmissions at
nodes other than the intended receiver. Meeting the first requirement generally
requires greater transmit power to increase the SNR at the intended receiver.
Meeting the second requirement generally requires reducing the transmit power to
reduce interference at nodes other than the intended receiver. The algorithm
used by Terragraph nodes for TPC operates in several phases.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tpc-phase-0">TPC Phase 0<a class="hash-link" href="#tpc-phase-0" title="Direct link to heading">​</a></h4><p>This phase of TPC occurs during beamforming acquisition. In this phase, the node
shall use the maximum allowable transmit power for the MCS of each transmission.
At the conclusion of beamforming acquisition, the nodes exchange Micro-route
Exchange frames (see
<a href="#beamforming-link-adaptation-micro-route-ordering-exchange">Micro-route Ordering Exchange</a>
and <a href="/docs/developer/MAC_PHY_Specification">MAC &amp; PHY Specification</a>).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tpc-phase-1">TPC Phase 1<a class="hash-link" href="#tpc-phase-1" title="Direct link to heading">​</a></h4><p>This phase of TPC occurs after the exchange of Micro-route Exchange frames at
the conclusion of beamforming acquisition. In phase 1, the nodes shall attempt
to reduce transmit power, using the received signal strength indication (RSSI)
indicated by the peer node and returned in the Micro-route Exchange frame and a
reference value for the RSSI expected at the peer node. If the RSSI indicated by
the peer node is greater than the reference RSSI value, the difference between
the two RSSI values is calculated. The algorithm reduces the difference to the
maximum allowable power reduction step size, if the difference is greater than
the allowable step size. In this phase, power the algorithm only reduces
transmit power, as needed.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peerStfSnrQ2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">refStfSnrStep1Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peerRssiQ2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">refRssiQ2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peerRssiQ2 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">refRssiQ2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delPowerQ2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delPowerStep1Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delPowerStep1Q2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tpc-phase-2">TPC Phase 2<a class="hash-link" href="#tpc-phase-2" title="Direct link to heading">​</a></h4><p>This phase of TPC occurs after the exchange of the Association Request,
Response, and Response Ack frames. In phase 2, the nodes shall attempt to reduce
transmit power, using the SNR value returned by the peer node in the Association
Response or Association Response ACK frame and a reference SNR value for the MCS
expected at the peer node to provide a high probability of error-free reception.
If the SNR indicated by the peer node is greater that the reference SNR value,
the difference between the two SNR values is calculated. The algorithm reduces
the difference to the maximum allowable power reduction step size, if the
difference is greater than the allowable step size. In this phase, the algorithm
only reduces transmit power, as needed.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">updEvt </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> TPC_UPD_AFTER_ASSOC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peerStfSnrQ2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">refStfSnrStep2Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">peerStfSnrQ2 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">refStfSnrStep2Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delPowerQ2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delPowerStep2Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delPowerStep2Q2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tpc-phase-3">TPC Phase 3<a class="hash-link" href="#tpc-phase-3" title="Direct link to heading">​</a></h4><p>This phase of TPC occurs after the link between the peer nodes is active and the
nodes exchange Heartbeat, Keep Alive, and/or Uplink Bandwidth Request frames.
In phase 3, the nodes shall attempt to increase and reduce transmit power, as
required, to maintain the peer SNR minimally greater than the reference SNR
value.  The algorithm speculatively calculates a power reduction value by
calculating the difference between the peer SNR value and the reference SNR
value.</p><p>If the peer SNR value is greater than the reference value, the power reduction
value is the minimum of the maximum allowable step value and the speculative
power reduction value reduced by a hysteresis amount. In this case the power
reduction value is used to reduce the transmit power.</p><p>If the peer SNR value is less than or equal to the reference value, the power
reduction value is the maximum of the allowable step size and the speculative
power reduction value increased by a hysteresis amount. In this case, the power
reduction value is used to increase the transmit power.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">updEvt </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> TPC_UPD_DURING_LINK_UP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> peerStfSnrQ2 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">refStfSnrStep3Q2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delPowerQ2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delPowerQ2 </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">tpcHysteresisdBQ2Step3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MIN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delPowerQ2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delPowerStep3Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delPowerQ2 </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">tpcHysteresisdBQ2Step3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delPowerQ2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MAX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delPowerQ2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">tp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delPowerStep3Q2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a id="beamforming-link-adaptation-glossary"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="glossary">Glossary<a class="hash-link" href="#glossary" title="Direct link to heading">​</a></h2><table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody><tr><td><strong>ACK</strong></td><td><strong>Acknowledgement;</strong> a receipt of data transmission</td></tr><tr><td><strong>BF</strong></td><td><strong>Beamforming;</strong> the process of using signal propagation information between two antennas and modifying antenna characteristics to maximize the signal quality between those antennas</td></tr><tr><td><strong>BLER</strong></td><td><strong>Block error rate;</strong> a ratio of the number of erroneous blocks to the total blocks received in a circuit</td></tr><tr><td><strong>BWGD</strong></td><td><strong>Bandwidth grant duration</strong></td></tr><tr><td><strong>C-PHY</strong></td><td><strong>C Physical Layer;</strong> a physical layer standard based on 3-phase symbol encoding</td></tr><tr><td><strong>E2E</strong></td><td><strong>End-to-End Service</strong>; a service responsible for runtime operations within a single Terragraph network</td></tr><tr><td><strong>FW</strong></td><td><strong>Firmware</strong></td></tr><tr><td><strong>IEEE</strong></td><td><strong>Institute of Electrical and Electronics Engineers</strong></td></tr><tr><td><strong>IMS</strong></td><td><strong>Interference measurement scan</strong></td></tr><tr><td><strong>L3</strong></td><td><strong>Layer 3;</strong> the network layer of the multilayered communication model</td></tr><tr><td><strong>LA</strong></td><td><strong>Link adaptation;</strong> the matching of modulation, coding, and other signal and protocol parameters</td></tr><tr><td><strong>LLC</strong></td><td><strong>Link level connection</strong></td></tr><tr><td><strong>LoS</strong></td><td><strong>Line of sight</strong></td></tr><tr><td><strong>MCS</strong></td><td><strong>Modulation and coding scheme</strong></td></tr><tr><td><strong>PBS</strong></td><td><strong>Periodic beamforming scan</strong></td></tr><tr><td><strong>PER</strong></td><td><strong>Packet error rate</strong></td></tr><tr><td><strong>RSSI</strong></td><td><strong>Received signal strength indication</strong></td></tr><tr><td><strong>SNR</strong></td><td><strong>Signal-to-noise ratio</strong></td></tr><tr><td><strong>TPC</strong></td><td><strong>Transmit power control</strong></td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/terragraph/meta-terragraph/edit/main/docs/../docs/developer/Beamforming_Link_Adaptation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developer/WiFi"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Wi-Fi</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developer/MAC_PHY_Specification"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">MAC &amp; PHY Specification</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#link-states-and-transitions" class="table-of-contents__link toc-highlight">Link States and Transitions</a><ul><li><a href="#link-down-state" class="table-of-contents__link toc-highlight">Link Down State</a></li><li><a href="#link-acquisition-state" class="table-of-contents__link toc-highlight">Link Acquisition State</a></li><li><a href="#link-up-state" class="table-of-contents__link toc-highlight">Link Up State</a></li><li><a href="#link-up-with-simultaneous-reacquisition-state" class="table-of-contents__link toc-highlight">Link Up with Simultaneous Reacquisition State</a></li><li><a href="#link-unstable-state" class="table-of-contents__link toc-highlight">Link Unstable State</a></li></ul></li><li><a href="#beamforming-procedures" class="table-of-contents__link toc-highlight">Beamforming Procedures</a><ul><li><a href="#beamforming-acquisition-and-reacquisition" class="table-of-contents__link toc-highlight">Beamforming Acquisition and Reacquisition</a></li><li><a href="#periodic-beamforming-scan" class="table-of-contents__link toc-highlight">Periodic Beamforming Scan</a></li><li><a href="#interference-measurement-scan" class="table-of-contents__link toc-highlight">Interference Measurement Scan</a></li><li><a href="#scheduling-scans-at-the-network-level" class="table-of-contents__link toc-highlight">Scheduling Scans at the Network Level</a></li><li><a href="#measurement-set-determination" class="table-of-contents__link toc-highlight">Measurement Set Determination</a></li><li><a href="#link-adaptation-procedure" class="table-of-contents__link toc-highlight">Link Adaptation Procedure</a></li></ul></li><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Terragraph</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/runbook/Overview">Overview</a></li><li class="footer__item"><a href="https://www.facebook.com/connectivity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meta Connectivity<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/terragraph" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/HQaxCevzus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ee1b3ecd.js"></script>
<script src="/assets/js/main.feb34f19.js"></script>
</body>
</html>