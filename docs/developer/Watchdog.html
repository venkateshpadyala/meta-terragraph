<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer/Watchdog">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Terragraph" href="/opensearch.xml">
<link rel="stylesheet" href="/katex/katex.min.css"><title data-rh="true">Watchdog | Terragraph</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://terragraph.com/logo/terragraph-logo-full-RGB.png"><meta data-rh="true" name="twitter:image" content="https://terragraph.com/logo/terragraph-logo-full-RGB.png"><meta data-rh="true" property="og:url" content="https://terragraph.com/docs/developer/Watchdog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Watchdog | Terragraph"><meta data-rh="true" name="description" content="This document describes the design and implementation of scripts and helper"><meta data-rh="true" property="og:description" content="This document describes the design and implementation of scripts and helper"><link data-rh="true" rel="icon" href="/logo/terragraph-logo-favicon-32x32-full-RGB.png"><link data-rh="true" rel="canonical" href="https://terragraph.com/docs/developer/Watchdog"><link data-rh="true" rel="alternate" href="https://terragraph.com/docs/developer/Watchdog" hreflang="en"><link data-rh="true" rel="alternate" href="https://terragraph.com/docs/developer/Watchdog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TB9T0CGM6Y-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.48218837.css">
<link rel="preload" href="/assets/js/runtime~main.ee1b3ecd.js" as="script">
<link rel="preload" href="/assets/js/main.feb34f19.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/terragraph-logo-favicon-32x32-full-RGB.svg" alt="Terragraph Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/logo/terragraph-logo-favicon-32x32-white-RGB.svg" alt="Terragraph Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/terragraph/meta-terragraph" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link githubButton navbarIconButton" title="GitHub"></a><a href="https://discord.gg/HQaxCevzus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link discordButton navbarIconButton" title="Discord"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/runbook">Runbook</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/developer">Developer Manual</a></li><li><a class="dropdown__link" href="/docs/whitepapers">Whitepapers</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/developer">Developer Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Communication_Protocol">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Beamforming_Link_Adaptation">Firmware Layer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Topology_Management">End-to-End (E2E) Service</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Stats_Events_Logs">Application Layer Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/developer/Service_Scripts">System Management</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Service_Scripts">Service Scripts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developer/Watchdog">Watchdog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/High_Availability">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Security">Security</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Release_Conventions">Version Control</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer"><span itemprop="name">Developer Manual</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">System Management</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Watchdog</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Watchdog</h1><p>This document describes the design and implementation of scripts and helper
applications that implement unit-level, autonomous state of health monitoring in
Terragraph nodes. This monitoring system detects, repairs, and logs various
faults.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-watchdog-concepts">General Watchdog Concepts<a class="hash-link" href="#general-watchdog-concepts" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hardware-watchdog">Hardware watchdog<a class="hash-link" href="#hardware-watchdog" title="Direct link to heading">​</a></h3><p>The hardware watchdog is a feature of ARM, NXP, and most other CPUs. When
enabled, a watchdog register is decremented every clock cycle, and when it
reaches zero or rolls over, the processor resets.</p><p>To prevent the hardware watchdog from resetting, software needs to keep writing
to it. This reset prevention is called &quot;kicking the watchdog&quot;. Normally the
watchdog kicks are deliberately stopped to ensure a certain reset, but sometimes
Linux crashes, resulting in a surprise reset. Terragraph detects and logs
&quot;dirty&quot; resets, and also collects context logs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="software-watchdog">Software watchdog<a class="hash-link" href="#software-watchdog" title="Direct link to heading">​</a></h3><p>The <a href="https://sourceforge.net/projects/watchdog/" target="_blank" rel="noopener noreferrer">software watchdog</a> (i.e. watchdog daemon) is a fairly standard Linux
application that kicks the hardware watchdog every second. Other <a href="https://linux.die.net/man/8/watchdog" target="_blank" rel="noopener noreferrer">software
watchdog actions</a> include monitoring memory, disk space, temperature, ping, etc.
(refer to the &quot;man&quot; pages in the software watchdog distribution). If the
software watchdog detects an unrepairable failure, it kills all processes,
unmounts all partitions, and stops kicking the hardware watchdog in order to
ensure a certain reset.</p><p>The watchdog daemon can also execute user-defined test/repair scripts, and
Terragraph uses this feature to perform platform-specific monitoring. The daemon
uses the exit code from the test scripts to decide what action to take.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="watchdog-cli-script">Watchdog CLI script<a class="hash-link" href="#watchdog-cli-script" title="Direct link to heading">​</a></h3><p>The watchdog CLI, <code>/etc/init.d/watchdog.sh</code>, is a Bash script that starts and
stops the watchdog daemon, and also performs Terragraph-specific watchdog state
changes. It is based on the <a href="https://github.com/openembedded/openembedded-core/blob/master/meta/recipes-extended/watchdog/watchdog/wd_keepalive.init" target="_blank" rel="noopener noreferrer">wd_keepalive.init</a> Yocto init script.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testrepair-scripts">Test/repair scripts<a class="hash-link" href="#testrepair-scripts" title="Direct link to heading">​</a></h3><p>The test/repair scripts are located in <code>/etc/watchdog.d/</code>, and are executed
concurrently by the watchdog daemon every second. There are four Terragraph
test/repair scripts (some of these execute several tests sequentially):</p><ul><li><code>link_monit.sh</code></li><li><code>pop_reachable_monit.sh</code></li><li><code>progress_monit.sh</code></li></ul><p>The daemon invokes each test/repair script with the following arguments: <code>test</code>
or <code>repair &lt;error_code&gt;</code>.</p><ul><li>The <code>test</code> invocation of the scripts return 0 to indicate success, or a
non-zero error code to indicate failure.</li><li>The <code>repair</code> invocation of the monitoring scripts only happens on errors.</li><li>The watchdog daemon passes the error code from the <code>test</code> invocation to the
<code>repair</code> invocation.</li><li>The <code>repair</code> invocation can request a reboot by exiting with a non-zero value.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terragraph-watchdog">Terragraph Watchdog<a class="hash-link" href="#terragraph-watchdog" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-core-affinity">CPU core affinity<a class="hash-link" href="#cpu-core-affinity" title="Direct link to heading">​</a></h3><p>The watchdog daemon and the scripts that it invokes all run on one particular
CPU core selected explicitly in the <code>startdaemon()</code> function in the
<code>watchdog.sh</code> CLI script.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h3><p>Watchdog-related configuration files are shown in the table below.</p><table><thead><tr><th>Config File</th><th>Description</th></tr></thead><tbody><tr><td><code>/etc/monit_config.sh</code></td><td>Parameters for each Terragraph watchdog test (e.g. deadlines, indicator file names).</td></tr><tr><td><code>/etc/watchdog.conf</code></td><td>Linux watchdog daemon configuration (e.g. timeouts for the test and repair phases, invocation interval). Note that if a test/repair script blocks for too long, the daemon reboots.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scripts-and-helper-applications">Scripts and helper applications<a class="hash-link" href="#scripts-and-helper-applications" title="Direct link to heading">​</a></h3><p>Other watchdog-related scripts and applications are shown in the table below.</p><table><thead><tr><th>Script/Application</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>get_pop_ip</code></td><td>Lua</td><td>Get the IP of every known PoP node from Open/R&#x27;s KvStore.</td></tr><tr><td><code>link_monit.sh</code></td><td>Bash</td><td>Test/repair script that performs multiple tests.</td></tr><tr><td><code>monit_init.sh</code></td><td>Bash</td><td>Reset the watchdog state on reboot and on e2e_minion restart.</td></tr><tr><td><code>monit_utils.sh</code></td><td>Bash</td><td>Helper functions.</td></tr><tr><td><code>monotonic-touch</code></td><td>C</td><td>Set and retrieve <code>CLOCK_MONOTONIC_RAW</code> file timestamps.</td></tr><tr><td><code>pop_reachable_monit.sh</code></td><td>Bash</td><td>Test/repair script that performs multiple tests.</td></tr><tr><td><code>progress_monit.sh</code></td><td>Bash</td><td>Test/repair script that performs multiple tests.</td></tr><tr><td><code>persist_event_cache.sh</code></td><td>Bash</td><td>Save/load untransmitted events persisted in flash (including watchdog events).</td></tr><tr><td><code>persist_reboot_history.sh</code></td><td>Bash</td><td>Manage <code>/data/log/reboot_history</code> log.</td></tr><tr><td><code>persist_remaining_gps_timeout.sh</code></td><td>Bash</td><td>Save/load the remaining GPS fault timeout in flash.</td></tr><tr><td><code>pop_unreachable_cmd.py</code></td><td>Python</td><td>Collect traceroute logs when no PoP node is reachable.</td></tr><tr><td><code>restart_e2e_minion.sh</code></td><td>Bash</td><td>Start and stop e2e_minion with retries.</td></tr><tr><td><code>testcode</code></td><td>Bash</td><td>Manage the &quot;testcode&quot; upgrade state, and display TG image info.</td></tr><tr><td><code>tg_shutdown</code></td><td>Bash</td><td>Invokes persist_xxx scripts at shutdown and rotates logs.</td></tr><tr><td><code>watchdog.sh</code></td><td>Bash</td><td>CLI for watchdog daemon and Terragraph tests</td></tr><tr><td><code>/usr/sbin/watchdog</code></td><td>C</td><td>The linux watchdog daemon.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="e2e-software-interaction-with-the-watchdog">E2E software interaction with the watchdog<a class="hash-link" href="#e2e-software-interaction-with-the-watchdog" title="Direct link to heading">​</a></h3><p>The E2E minion interacts with the watchdog as shown in the table below.</p><table><thead><tr><th>E2E minion module</th><th>Watchdog interaction</th></tr></thead><tbody><tr><td><code>WatchdogUtils</code> helper class</td><td>Encapsulates watchdog functionality (set empty <code>--watchdog_path</code> flag to disable minion/watchdog interactions)</td></tr><tr><td><code>Progress</code> helper class</td><td>Sets file timestamps of indicator files to the current monotonic time, using the same clock (<code>CLOCK_MONOTONIC_RAW</code>) as the monotonic-touch watchdog helper application. Creates the indicator files when necessary.</td></tr><tr><td><code>Minion</code> main event loop</td><td><ul><li>Reports event loop progress.</li><li>If the e2e_minion event loop is dead, then the watchdog does not intervene when firmware health messages cease, and lets the runsv services monitor restart e2e_minon (and reload the baseband firmware).</li><li>If the e2e_minion event loop is running <em>and</em> firmware health messages cease, then the watchdog assumes that the baseband firmware has crashed, or the datapath from the firmware to Linux is dead - and the watchdog intervenes, collects logs, and restarts e2e_minion (along with the baseband firmware). See the Watchdog Fault Table for more details.</li></ul></td></tr><tr><td><code>ArmDriverIf</code></td><td><code>processFwHealthyMessage()</code> reports firmware and gps health to the watchdog.</td></tr><tr><td><code>StatusApp</code></td><td><ul><li><code>processRebootNode()</code> rejects unforced reboot command in the &quot;testcode&quot; upgrade states. Reboot in this state could cause a surprise image rollback. Note that the &quot;testcode&quot; states are monitored by the watchdog.</li><li><code>processStatusReportAck()</code> reports controller status acknowledgments to the watchdog. These indicate that the node is &quot;connected&quot; to the controller.</li></ul></td></tr><tr><td><code>UpgradeApp</code></td><td><code>processMessage()</code> temporarily disables most Terragraph watchdogs during each upgrade phase. This reduces the possibility of dangerous flash corruptions (e.g. during bootloader update), and also avoids losing upgrade states. Note that the watchdog automatically re-enables itself when the disable period expires.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="platform-software-interaction-with-the-watchdog">Platform software interaction with the watchdog<a class="hash-link" href="#platform-software-interaction-with-the-watchdog" title="Direct link to heading">​</a></h3><p>The platform software interacts with the watchdog as shown in the table below.</p><table><thead><tr><th>Platform software</th><th>Watchdog interaction</th></tr></thead><tbody><tr><td>Wi-Fi (Puma) message server</td><td><code>messageHandler()</code> temporarily disables most Terragraph watchdogs while processing commands. Wireless command messages include a field for the watchdog disable time period. There is also a standalone wireless command (<code>WATCHDOG</code>) to temporarily disable or re-enable the watchdog. Note that the watchdog automatically re-enables itself when the disable time period expires.</td></tr><tr><td><code>flash_mtd.sh</code> startup script</td><td><ul><li>Kicks off configuration fallback monitoring when the current startup/reboot was <em>required</em> to apply the new configuration.</li><li>Performs configuration rollback in different image fallback states:<ol><li>No upgrade or fallback is in progress.</li><li>The current startup/reboot reverted the upgrade image, and need to roll back to the pre-upgrade configuration. See the Watchdog Fault Table for more information about &quot;testcode&quot; faults.</li></ol></li><li>Note that the primary function of the <code>flash_mtd.sh</code> startup script is to (re)initialize and mount the <code>/data</code> flash partition.</li></ul></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="locks">Locks<a class="hash-link" href="#locks" title="Direct link to heading">​</a></h3><p><a href="http://man7.org/linux/man-pages/man1/flock.1.html" target="_blank" rel="noopener noreferrer">flock</a> is used by the watchdog for the following purposes:</p><ul><li>Ensure that repair actions don&#x27;t run concurrently.</li><li>Ensure that only one watchdog thread/script shuts down.</li><li>Synchronize state updates which can happen from different contexts. For
example, the watchdog can be disabled for a fixed time period by a user and
also by the E2E minion during upgrades; config rollback states are set by the
watchdog and also by the <code>ConfigApp</code> in the E2E minion.</li></ul><p>Indicator files are used for the following purposes:</p><ul><li>Prevent the re-execution of a test script before the corresponding repair
invocation is done (this is a feature/bug in the watchdog daemon).</li><li>Skip the testing logic by returning 0 (&quot;OK&quot;) to the daemon when a
shutdown/reboot is in progress.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="watchdog-state">Watchdog state<a class="hash-link" href="#watchdog-state" title="Direct link to heading">​</a></h3><p>The runtime state of the watchdog is comprised of indicator files and a few data
files in <code>/var/volatile/progress</code>. The state is mostly a collection of
timestamps of various past events, and some deadlines. File timestamps are used
to keep event/deadline times using a monotonic clock (<code>CLOCK_MONOTONIC_RAW</code>).
Scripts use the <code>monotonic_touch</code> helper application to &quot;touch&quot; indicator
files with current or future monotonic time.</p><p>Some watchdog state (e.g. remaining GPS timeout, unsent watchdog events) needs
to be persisted across reboots, and is saved temporarily in <code>/data</code> at shutdown.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testrepair-scripting-considerations">Test/repair scripting considerations<a class="hash-link" href="#testrepair-scripting-considerations" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dont-write-to-stdout-or-stderr-from-the-testrepair-scripts">Don&#x27;t write to stdout (or stderr) from the test/repair scripts<a class="hash-link" href="#dont-write-to-stdout-or-stderr-from-the-testrepair-scripts" title="Direct link to heading">​</a></h4><p>Most of the test/repair functions write &quot;0&quot; or &quot;1&quot; to stdout to indicate
success/failure. Random output by linux commands can result in surprise test
failures and repair failures causing a reboot.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Unsafe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sv restart fib_nss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sv restart fib_nss </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-a-timeout-for-commands-that-may-take-a-while-in-testrepair-scripts">Set a timeout for commands that may take a while in test/repair scripts<a class="hash-link" href="#set-a-timeout-for-commands-that-may-take-a-while-in-testrepair-scripts" title="Direct link to heading">​</a></h4><p>The test and repair phases both have deadlines set in <code>/etc/watchdog.conf</code>.
The watchdog daemon reboots when these deadlines are exceeded.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Unsafe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">save_gps_version.sh /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Safe (timeout values here are only examples)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">timeout</span><span class="token plain"> -k </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> save_gps_version.sh /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"> -ne </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Oops. Timed out. Handle timeout explicitly.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-the-watchdog">Debugging the watchdog<a class="hash-link" href="#debugging-the-watchdog" title="Direct link to heading">​</a></h3><p>Three methods for debugging the watchdog are described below.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-testrepair-script-errors">Monitor test/repair script errors<a class="hash-link" href="#monitor-testrepair-script-errors" title="Direct link to heading">​</a></h4><p>Error logs are kept for both the test and the repair phases
in <code>/var/log/watchdog</code>. These error log files are normally empty, which means
that there were no script errors.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -l /var/log/watchdog/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:57 repair-bin.stderr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:57 repair-bin.stdout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:57 test-bin.stderr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Jun </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:41 test-bin.stdout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-debug-logs">Use the debug logs<a class="hash-link" href="#use-the-debug-logs" title="Direct link to heading">​</a></h4><p>The test/repair scripts report internal states on every invocation. This
debug logging functionality is implemented by <code>monit_debug()</code> in
<code>monit_config.sh</code>. The debug logs are test-script specific, have a monotonic
timestamp, and appear in <code>/data/log/wdog</code>. Note that these logs are not rotated
and <strong>can fill up the flash</strong>.</p><p>Debug logging can be enabled/disabled in two ways:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Enable/disable debug logging until the next reboot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ /etc/init.d/watchdog.sh en_logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ /etc/init.d/watchdog.sh dis_logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Enable/disable debug logging permanently</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /data/log/wdog/wdog_log_enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f /data/log/wdog/wdog_log_enable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="observe-the-operator-watchdog-logs-and-the-watchdog-state">Observe the operator watchdog logs and the watchdog state<a class="hash-link" href="#observe-the-operator-watchdog-logs-and-the-watchdog-state" title="Direct link to heading">​</a></h4><p>The normal reboot and watchdog logs are helpful for debugging issues:</p><ul><li><code>/var/log/wdog_repair_history</code></li><li><code>/var/log/wdog_repair_history.2</code></li><li><code>/data/log/reboot_history</code></li><li><code>/data/log/reboot_history.2</code></li></ul><p>To observe most of the runtime state, execute the following command (note that
<code>monotonic-touch -t</code> prints the current monotonic time):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">watch</span><span class="token plain"> -n </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;monotonic-touch -t; for f in $(find /var/volatile/progress -type f | sort); \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  do echo -n &quot;$f &quot;;stat -c %Y $f; done&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-entry-points">Test entry points<a class="hash-link" href="#test-entry-points" title="Direct link to heading">​</a></h3><p>The &quot;entry point&quot; is the name of the main bash function for each test. Note that
some tests have helper functions, and others are implemented by test logic
embedded in the main <code>test_xxx()</code> function that is called when the test script
is invoked with the &quot;test&quot; argument by the watchdog daemon.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="puma-watchdog-test-entry-points">Puma watchdog test entry points<a class="hash-link" href="#puma-watchdog-test-entry-points" title="Direct link to heading">​</a></h4><table><thead><tr><th>Description</th><th>Script</th><th>Bash Function</th><th>Notes</th></tr></thead><tbody><tr><td>Monitor the &quot;testcode&quot; upgrade state.</td><td><code>progress_monit.sh</code></td><td><code>test_testcode_fallback()</code></td><td>In the &quot;testcode&quot; state, the unit is running (&quot;testing&quot;) an upgrade image from the secondary boot partition. A reboot for any reason will cause a rollback to the original image in the primary boot partition. This watchdog reboots if the new image (specifically, <code>e2e_minion</code>) fails to connect to the controller by a deadline.</td></tr><tr><td>Re-enable the disabled watchdogs.</td><td><code>progress_monit.sh</code></td><td><code>timed_enable_tgscripts()</code></td><td>Most watchdogs can be disabled safely for a fixed period of time via the CLI by running <code>/etc/init.d/watchdog.sh dis &lt;minutes&gt;</code>. This watchdog re-enables the disabled watchdogs at the deadline set by the CLI.</td></tr><tr><td>Monitor GPS sanity.</td><td><code>progress_monit.sh</code></td><td><code>test_gps()</code></td><td>See the Watchdog Fault Table for details.</td></tr><tr><td>A baseband card was unable to form RF links for about 15 minutes.</td><td><code>progress_monit.sh</code></td><td><code>test_prog()</code></td><td>See the Watchdog Fault Table for details.</td></tr><tr><td>Baseband firmware or datapath timeout/crash.</td><td><code>progress_monit.sh</code></td><td><code>test_prog()</code></td><td>There are two different failure modes. See the Watchdog Fault Table for details.</td></tr><tr><td>Monitor <code>/tmp</code> full.</td><td><code>pop_reachable_monit.sh</code></td><td><code>test_fsys()</code></td><td>n/a</td></tr><tr><td>Monitor <code>/data</code> full.</td><td><code>pop_reachable_monit.sh</code></td><td><code>test_fsys()</code></td><td>n/a</td></tr><tr><td>Roll back bad configuration (specifically, new node configuration that prevents connecting to the controller).</td><td><code>pop_reachable_monit.sh</code></td><td><code>test_config_fallback()</code></td><td>There are several different failure modes. See the Watchdog Fault Table for details.</td></tr><tr><td>Test PoP node reachability.</td><td><code>pop_reachable_monit.sh</code></td><td><code>test_pop_reachable()</code></td><td>See the Watchdog Fault Table for details.</td></tr><tr><td>No RF peer is reachable, although some RF links are up.</td><td><code>link_monit.sh</code></td><td><code>test_link()</code></td><td>n/a</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a class="hash-link" href="#resources" title="Direct link to heading">​</a></h2><ul><li><a href="https://sourceforge.net/projects/watchdog/" target="_blank" rel="noopener noreferrer">software watchdog</a> - Linux software watchdog</li><li><a href="https://linux.die.net/man/8/watchdog" target="_blank" rel="noopener noreferrer">software watchdog actions</a> - Linux software watchdog actions</li><li><a href="https://github.com/openembedded/openembedded-core/blob/master/meta/recipes-extended/watchdog/watchdog/wd_keepalive.init" target="_blank" rel="noopener noreferrer">wd_keepalive.init</a> - Yocto watchdog keepalive daemon manager</li><li><a href="http://man7.org/linux/man-pages/man1/flock.1.html" target="_blank" rel="noopener noreferrer">flock</a> - Manage locks from shell scripts</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/terragraph/meta-terragraph/edit/main/docs/../docs/developer/Watchdog.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developer/Service_Scripts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Service Scripts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developer/High_Availability"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">High Availability</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-watchdog-concepts" class="table-of-contents__link toc-highlight">General Watchdog Concepts</a><ul><li><a href="#hardware-watchdog" class="table-of-contents__link toc-highlight">Hardware watchdog</a></li><li><a href="#software-watchdog" class="table-of-contents__link toc-highlight">Software watchdog</a></li><li><a href="#watchdog-cli-script" class="table-of-contents__link toc-highlight">Watchdog CLI script</a></li><li><a href="#testrepair-scripts" class="table-of-contents__link toc-highlight">Test/repair scripts</a></li></ul></li><li><a href="#terragraph-watchdog" class="table-of-contents__link toc-highlight">Terragraph Watchdog</a><ul><li><a href="#cpu-core-affinity" class="table-of-contents__link toc-highlight">CPU core affinity</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#scripts-and-helper-applications" class="table-of-contents__link toc-highlight">Scripts and helper applications</a></li><li><a href="#e2e-software-interaction-with-the-watchdog" class="table-of-contents__link toc-highlight">E2E software interaction with the watchdog</a></li><li><a href="#platform-software-interaction-with-the-watchdog" class="table-of-contents__link toc-highlight">Platform software interaction with the watchdog</a></li><li><a href="#locks" class="table-of-contents__link toc-highlight">Locks</a></li><li><a href="#watchdog-state" class="table-of-contents__link toc-highlight">Watchdog state</a></li><li><a href="#testrepair-scripting-considerations" class="table-of-contents__link toc-highlight">Test/repair scripting considerations</a></li><li><a href="#debugging-the-watchdog" class="table-of-contents__link toc-highlight">Debugging the watchdog</a></li><li><a href="#test-entry-points" class="table-of-contents__link toc-highlight">Test entry points</a></li></ul></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Terragraph</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/runbook/Overview">Overview</a></li><li class="footer__item"><a href="https://www.facebook.com/connectivity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meta Connectivity<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/terragraph" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/HQaxCevzus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ee1b3ecd.js"></script>
<script src="/assets/js/main.feb34f19.js"></script>
</body>
</html>