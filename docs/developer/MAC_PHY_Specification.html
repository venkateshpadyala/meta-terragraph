<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer/MAC_PHY_Specification">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Terragraph" href="/opensearch.xml">
<link rel="stylesheet" href="/katex/katex.min.css"><title data-rh="true">MAC &amp; PHY Specification | Terragraph</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://terragraph.com/logo/terragraph-logo-full-RGB.png"><meta data-rh="true" name="twitter:image" content="https://terragraph.com/logo/terragraph-logo-full-RGB.png"><meta data-rh="true" property="og:url" content="https://terragraph.com/docs/developer/MAC_PHY_Specification"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MAC &amp; PHY Specification | Terragraph"><meta data-rh="true" name="description" content="The link protocol used between Terragraph nodes is a modified version of the"><meta data-rh="true" property="og:description" content="The link protocol used between Terragraph nodes is a modified version of the"><link data-rh="true" rel="icon" href="/logo/terragraph-logo-favicon-32x32-full-RGB.png"><link data-rh="true" rel="canonical" href="https://terragraph.com/docs/developer/MAC_PHY_Specification"><link data-rh="true" rel="alternate" href="https://terragraph.com/docs/developer/MAC_PHY_Specification" hreflang="en"><link data-rh="true" rel="alternate" href="https://terragraph.com/docs/developer/MAC_PHY_Specification" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TB9T0CGM6Y-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.48218837.css">
<link rel="preload" href="/assets/js/runtime~main.ee1b3ecd.js" as="script">
<link rel="preload" href="/assets/js/main.feb34f19.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/terragraph-logo-favicon-32x32-full-RGB.svg" alt="Terragraph Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/logo/terragraph-logo-favicon-32x32-white-RGB.svg" alt="Terragraph Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/terragraph/meta-terragraph" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link githubButton navbarIconButton" title="GitHub"></a><a href="https://discord.gg/HQaxCevzus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link discordButton navbarIconButton" title="Discord"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/runbook">Runbook</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/developer">Developer Manual</a></li><li><a class="dropdown__link" href="/docs/whitepapers">Whitepapers</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/developer">Developer Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Communication_Protocol">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/developer/Beamforming_Link_Adaptation">Firmware Layer</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Beamforming_Link_Adaptation">Beamforming and Link Adaptation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developer/MAC_PHY_Specification">MAC &amp; PHY Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/PHY_Algorithms">PHY Algorithms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/Firmware_Stats">Firmware Stats</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Topology_Management">End-to-End (E2E) Service</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Stats_Events_Logs">Application Layer Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Service_Scripts">System Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/developer/Release_Conventions">Version Control</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer"><span itemprop="name">Developer Manual</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Firmware Layer</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MAC &amp; PHY Specification</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>MAC &amp; PHY Specification</h1><p>The link protocol used between Terragraph nodes is a modified version of the
Directed Multigigabit (DMG) physical layer (PHY) in clause 20 of IEEE Standard
IEEE 802.11-2016, previously the IEEE 802.11ad-2012 amendment to IEEE Standard
IEEE 802.11-2012. Terragraph uses the DMG PHY, or radio, and a significantly
slimmed down Media Access Control (MAC) layer. This document presents the
specifications for these layers.</p><p>The <a href="#mac-phy-spec-glossary">Glossary</a> defines the terms and acronyms used in
this document.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terragraph-physical-layer">Terragraph Physical Layer<a class="hash-link" href="#terragraph-physical-layer" title="Direct link to heading">​</a></h2><p>The Terragraph PHY connects one Terragraph node to another. All communication
between Terragraph nodes occurs over this PHY. With slight modifications,
Terragraph uses the DMG Single Carrier PHY and the DMG control mode of IEEE
802.11-2016. For more information on the DMG PHY, refer to clause 20 of IEEE
802.11-2016.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dmg-control-mode">DMG Control Mode<a class="hash-link" href="#dmg-control-mode" title="Direct link to heading">​</a></h3><p>Terragraph nodes use the DMG Control Mode to transmit the ACK Control frames and
the Management Action frames. This maximizes the likelihood of successful
reception of these frames at the destination and minimizes the consumption of
the available bandwidth.</p><p>Table 1 shows the modulation and coding scheme for the DMG Control Mode.</p><table><thead><tr><th><strong>MCS Index</strong></th><th><strong>Modulation</strong></th><th><strong>Code Rate</strong></th><th><strong>Data Rate(Mbps)</strong></th></tr></thead><tbody><tr><td>0</td><td>DBPSK</td><td>1/2</td><td>27.5</td></tr></tbody></table><p><em>Table 1, Modulation and Coding Scheme for DMG Control Mode PHY</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dmg-single-carrier-phy">DMG Single Carrier PHY<a class="hash-link" href="#dmg-single-carrier-phy" title="Direct link to heading">​</a></h3><p>Terragraph nodes use the DMG Single Carrier (SC) PHY. Terragraph nodes may
include the optional addition to select the Golay codes used in the PHY
preamble. Because the Terragraph network might operate on a single channel, the
potential for self-interference from other Terragraph nodes as well as
interference from other DMG networks is a possibility.</p><p>The Terragraph SC PHY assigns alternative Golay codes from the DMG PHY preamble
as a means for early rejection of interfering signals. Assigning different codes
to nodes that could interfere with each other mitigates that interference. The
E2E controller programs the Golay codes used by each sector in the Terragraph
network.</p><p>Terragraph nodes use the DMG SC PHY to transmit all data frames and the Block
ACK control frame. Terragraph uses commercial DMG radio chips for the radio link
between nodes.</p><p>Table 2 shows the modulation and coding scheme of the DMG SC PHY. Note that
&quot;N_CBPS&quot; represents the number of code bits per symbol.</p><table><thead><tr><th>MCS Index</th><th>Modulation</th><th>N_CBPS</th><th>Repetition</th><th>Code rate</th><th>Data rate (Mbps)</th></tr></thead><tbody><tr><td>MCS-1</td><td>𝛑<!-- -->/2 BPSK</td><td>1</td><td>2</td><td>1/2</td><td>385</td></tr><tr><td>MCS-2</td><td>𝛑<!-- -->/2 BPSK</td><td>1</td><td>1</td><td>1/2</td><td>770</td></tr><tr><td>MCS-3</td><td>𝛑<!-- -->/2 BPSK</td><td>1</td><td>1</td><td>5/8</td><td>962.5</td></tr><tr><td>MCS-4</td><td>𝛑<!-- -->/2 BPSK</td><td>1</td><td>1</td><td>3/4</td><td>1155</td></tr><tr><td>MCS-5</td><td>𝛑<!-- -->/2 BPSK</td><td>1</td><td>1</td><td>13/16</td><td>1251.25</td></tr><tr><td>MCS-6</td><td>𝛑<!-- -->/2 QPSK</td><td>2</td><td>1</td><td>1/2</td><td>1540</td></tr><tr><td>MCS-7</td><td>𝛑<!-- -->/2 QPSK</td><td>2</td><td>1</td><td>5/8</td><td>1925</td></tr><tr><td>MCS-8</td><td>𝛑<!-- -->/2 QPSK</td><td>2</td><td>1</td><td>3/4</td><td>2310</td></tr><tr><td>MCS-9</td><td>𝛑<!-- -->/2 QPSK</td><td>2</td><td>1</td><td>13/16</td><td>2502.5</td></tr><tr><td>MCS-10</td><td>𝛑<!-- -->/2 16QAM</td><td>4</td><td>1</td><td>1/2</td><td>3080</td></tr><tr><td>MCS-11</td><td>𝛑<!-- -->/2 16QAM</td><td>4</td><td>1</td><td>5/8</td><td>3850</td></tr><tr><td>MCS-12</td><td>𝛑<!-- -->/2 16QAM</td><td>4</td><td>1</td><td>3/4</td><td>4620</td></tr></tbody></table><p><em>Table 2, Modulation and Coding Scheme for DMG Control Mode PHY</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-of-phy-parameters">Configuration of PHY Parameters<a class="hash-link" href="#configuration-of-phy-parameters" title="Direct link to heading">​</a></h3><p>The E2E controller manages the configuration of PHY parameters using the Node
Parameters Message. The selection of polarity, Golay code, and link adaptation
algorithm parameters derive from values in the Node Parameters Message.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terragraph-media-access-control-overview">Terragraph Media Access Control Overview<a class="hash-link" href="#terragraph-media-access-control-overview" title="Direct link to heading">​</a></h2><p>The version of the DMG MAC used in a Terragraph node is highly modified from
that in IEEE 802.11-2016. The modifications make it a highly efficient TDD MAC
by substituting TDD access for all other access mechanisms specified in IEEE
802.11. Terragraph uses only the following frames:</p><ul><li>Data</li><li>QoS-Null</li><li>Management Action (vendor specific)</li><li>Block ACK (with Facebook proprietary modification)</li><li>ACK</li></ul><p>Terragraph maximizes efficiency of the MAC, by aggregating the MAC Service Data
Units (MSDUs) and the MAC Protocol Data Units (MPDUs) as much as possible to
reduce overhead and to eliminate interframe spacing that results in dead air
time.</p><p>The A-MSDU format is proprietary to Terragraph, but the A-MPDU is standard
compliant.</p><p>The MAC also utilizes block acknowledgement to minimize the number of frames
exchanged between sender and receiver. The block acknowledgement does not
require prior setup, as the format and reordering buffer size are fixed. The TDD
slots assigned to block acknowledgement are also fixed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initiator-and-responder-nodes">Initiator and Responder Nodes<a class="hash-link" href="#initiator-and-responder-nodes" title="Direct link to heading">​</a></h3><p>A Terragraph network is a software defined network (SDN) controlled by an
End-to-End (E2E) controller. The E2E controller typically runs in the cloud. The
Terragraph nodes communicate with the E2E controller.</p><p>The point at which the Terragraph network connects to the network through which
communication with the E2E controller is established is called a point of
presence (PoP). This document defines &quot;upstream&quot; as communication toward the PoP
by a Terragraph node and &quot;downstream&quot; as communication from the PoP toward a
Terragraph node.</p><p>In the MAC protocol and procedures, one node typically begins the procedure and
another node reacts. This document defines the node that begins a procedure as
the initiator node, and the node that reacts to the procedure as the responder
node. The initiator node is upstream from the responder node.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="multirate-operation">Multirate Operation<a class="hash-link" href="#multirate-operation" title="Direct link to heading">​</a></h3><p>Multirate operation enables different rates for data, management, and control
frames.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-frames">Data Frames<a class="hash-link" href="#data-frames" title="Direct link to heading">​</a></h4><p>A node sends data frames using MCS 2 through MCS 12 of the DMG single carrier
PHY, as determined by the link adaptation algorithm.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="management-frames">Management Frames<a class="hash-link" href="#management-frames" title="Direct link to heading">​</a></h4><p>A node sends all management frames using the DMG control mode PHY, MCS 0.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="control-frames">Control Frames<a class="hash-link" href="#control-frames" title="Direct link to heading">​</a></h4><p>A node sends the ACK frame using the DMG control mode PHY, MCS 0. A node sends
the Block ACK frame using the DMG single carrier PHY, MCS 1.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terragraph-mac-frame-definitions">Terragraph MAC Frame Definitions<a class="hash-link" href="#terragraph-mac-frame-definitions" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-frames-1">Data Frames<a class="hash-link" href="#data-frames-1" title="Direct link to heading">​</a></h3><p>Data frames are standard compliant QoS data frames.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-mpdu-format">A-MPDU Format<a class="hash-link" href="#a-mpdu-format" title="Direct link to heading">​</a></h3><p>A-MPDU format is standard compliant.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-msdu-format">A-MSDU Format<a class="hash-link" href="#a-msdu-format" title="Direct link to heading">​</a></h4><p>Terragraph uses a proprietary A-MSDU format. A Terragraph A-MSDU data frame
shall have the following MAC header fields:</p><ul><li><strong>RA:</strong> Receiver Address field, 6 bytes</li><li><strong>TA:</strong> Transmitter Address field, 6 bytes</li><li><strong>Type:</strong> Type field, 2 bytes</li><li><strong>NX:</strong> Network Accelerator field, 6 bytes</li><li><strong>SL:</strong> Subframe Lengths field</li></ul><p>Figure 1 illustrates the format of the Terragraph A-MSDU data frame.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/AMSDU_Frame_Format.png" width="512" class="img_ev3q"><br><em>Figure 1, A-MSDU Frame Format</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ra-field">RA field<a class="hash-link" href="#ra-field" title="Direct link to heading">​</a></h4><p>The Receiver Address (RA) field shall contain the MAC address of the intended
receiver node of the data frame.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ta-field">TA field<a class="hash-link" href="#ta-field" title="Direct link to heading">​</a></h4><p>The Transmitter Address field (TA) contains the MAC address of the node
transmitting the data frame.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="type-field">Type field<a class="hash-link" href="#type-field" title="Direct link to heading">​</a></h4><p>The Type field has the value 0x89FB.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="nx-field">NX field<a class="hash-link" href="#nx-field" title="Direct link to heading">​</a></h4><p>The Network Accelerator (NX) field includes the following subfields:</p><ul><li><strong>Type:</strong> 1 byte</li><li><strong>CtxID:</strong> 1 byte</li><li><strong>NoS:</strong> 1 byte</li><li><strong>Reserved:</strong> 3 bytes</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="type-field-1">Type field<a class="hash-link" href="#type-field-1" title="Direct link to heading">​</a></h4><p>The NX Type field indicates the type of A-MSDU subframes contained in the data
frame.</p><ul><li>A value of zero (0) indicates short A-MSDU subframes.</li><li>A value of 1 indicates basic A-MSDU subframes.</li></ul><p>Currently, the NX Type field value is always zero (0), indicating short A-MSDU
subframes.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ctxid-field">CtxID field<a class="hash-link" href="#ctxid-field" title="Direct link to heading">​</a></h5><p>The Context ID (CtxID) field carries an opaque value of significance to the
network accelerator. If the context is unknown or none, the value of the CtxID
field is 0xFF.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="nos-field">NoS field<a class="hash-link" href="#nos-field" title="Direct link to heading">​</a></h4><p>The Number of Subframes (NoS) field carries a value that indicates the number of
A-MSDU subframes contained in the data frame. The value of this field shall be
greater than 0.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="reserved-field">Reserved field<a class="hash-link" href="#reserved-field" title="Direct link to heading">​</a></h4><p>The Reserved field is 3 bytes, set to the value of zero (0). On reception, a
node ignores the reserved field.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sl-field">SL Field<a class="hash-link" href="#sl-field" title="Direct link to heading">​</a></h4><p>The Subframe Lengths Field (SL) field carries the lengths of the first NoS-1
A-MSDU subframes. The length of each A-MSDU subframe is carried in 2 bytes. The
length of the SL field is <code>2 * (NoS-1)</code> bytes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="msdu-fields">MSDU fields<a class="hash-link" href="#msdu-fields" title="Direct link to heading">​</a></h4><p>The A-MSDU subframe fields carry only the MSDU submitted to the MAC for
delivery. The A-MSDU subframes shall modify the short A-MSDU format, as
specified in IEEE 802.11-2016. Terragraph A-MSDU subframes shall not include the
length or padding bytes fields of the IEEE 802.11-2016 short A-MSDU subframe
format.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="control-frames-1">Control Frames<a class="hash-link" href="#control-frames-1" title="Direct link to heading">​</a></h3><p>Terragraph transmits only ACK and Block ACK control frames.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="block-ack">Block ACK<a class="hash-link" href="#block-ack" title="Direct link to heading">​</a></h4><p>Terragraph uses a proprietary Block ACK format based on the compressed Block ACK
variant for fast link adaptation.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ack">ACK<a class="hash-link" href="#ack" title="Direct link to heading">​</a></h4><p>ACK is standard compliant.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="management-message">Management Message<a class="hash-link" href="#management-message" title="Direct link to heading">​</a></h3><p>Terragraph uses vendor-specific Action frames, as shown in Table 3.</p><table><thead><tr><th></th><th>MAC Header</th><th>Action Category</th><th>OUI</th><th>Vendor Specific</th><th>FCS</th></tr></thead><tbody><tr><td>Value</td><td>−−</td><td>127</td><td>48-57-DD</td><td>−−</td><td>−−</td></tr><tr><td>Bytes</td><td>24 or 28</td><td>1</td><td>3</td><td>Variable</td><td>4</td></tr></tbody></table><p><em>Table 3, Format of Vendor-Specific Action Frame</em></p><ul><li>The Action Category value of the Action field of the Action frame is Vendor
Specific (127), as specified in section 9.4.1.11 of IEEE 802.11-2016.</li><li>The OUI, as required in section 9.6.6 of IEEE 802.11-2016, is 48-57-DD, the
organizational unique identifier allocated to Facebook by the IEEE.</li><li>The Vendor Specific field contains the <code>fbActionType</code>. The <code>fbActionType</code> is
sent in a management message to indicate the type of message.</li><li>The FCS field (Frame Check Sequence field) is an optional variable length
field that is determined by the value of <code>fbActionType</code>.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fb-action-type">FB Action Type<a class="hash-link" href="#fb-action-type" title="Direct link to heading">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">_fbActionType</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSOC_REQ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSOC_RSP </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSOC_RSP_ACK </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HEART_BEAT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_TRAINING_REQ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_TRAINING_RSP </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_TRAINING_RSP_ACK </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_TRAINING_URX </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KEEP_ALIVE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DISASSOC_REQ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UPLINK_BWREQ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_RETRAINING_REQ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_RETRN_URX_CHG_REQ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BF_RETRN_URX_CHG_REQ_ACK </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FB_MAX_ACTION_TYPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> fbActionType</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>ASSOC_REQ</code></td><td>Association request message.</td></tr><tr><td><code>ASSOC_RSP</code></td><td>Sent in response to <code>ASSOC_REQ</code>.</td></tr><tr><td><code>ASSOC_RSP_ACK</code></td><td>Sent in response to <code>ASSOC_RSP</code>.</td></tr><tr><td><code>HEART_BEAT</code></td><td>Management message sent every 25.6ms from a DN to a CN.</td></tr><tr><td><code>BF_TRAINING_REQ</code></td><td>Initial beamforming request.</td></tr><tr><td><code>BF_TRAINING_RSP</code></td><td>Initial beamforming response.</td></tr><tr><td><code>BF_TRAINING_RSP_ACK</code></td><td>Initial beamforming response ACK.</td></tr><tr><td><code>BF_TRAINING_URX</code></td><td>Initial beamforming URX. URX is the final stage of initial beamforming before <code>ASSOC_REQ</code> is sent.</td></tr><tr><td><code>KEEP_ALIVE</code></td><td>Management message sent every 25.6ms between DNs.</td></tr><tr><td><code>DISASSOC_REQ</code></td><td>Disassociation request message to terminate communication with the recipient node.</td></tr><tr><td><code>UPLINK_BWREQ</code></td><td>Management message sent every 25.6ms from a CN to a DN.</td></tr><tr><td><code>BF_RETRAINING_REQ</code></td><td></td></tr><tr><td><code>BF_RETRN_URX_CHG_REQ</code></td><td>From scan responder to initiator.</td></tr><tr><td><code>BF_RETRN_URX_CHG_REQ_AC</code></td><td>From scan initiator to responder.</td></tr><tr><td><code>FB_MAX_ACTION_TYPE</code></td><td></td></tr></tbody></table><p><em>Table 4, <code>fbACtionType</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="structures-common-to-management-frames">Structures Common to Management Frames<a class="hash-link" href="#structures-common-to-management-frames" title="Direct link to heading">​</a></h4><p>This section describes several structures and values that are common to
different management frames.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="layer-2-scheduler-statistics">Layer 2 Scheduler Statistics<a class="hash-link" href="#layer-2-scheduler-statistics" title="Direct link to heading">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_l2SchedulerStats</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 queueSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 arrivalRate</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 mcs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 reqTxPercent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> l2SchedulerStats</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>queueSize</code></td><td>Queue size in 256-byte units.</td></tr><tr><td><code>arrivalRate</code></td><td>Arrival rate (in units of 128 Kbps or 16 bytes/ms).</td></tr><tr><td><code>mcs</code></td><td>MCS value.</td></tr><tr><td><code>reqTxPercent</code></td><td>Requested Tx percentage in units of 0.01 percent.</td></tr></tbody></table><p><em>Table 5, <code>l2SchedulerStats</code> Field Descriptions</em></p><a id="mac-phy-spec-link-adaptation-feedback-parameters"></a><h5 class="anchor anchorWithStickyNavbar_LWe7" id="link-adaptation-feedback-parameters">Link Adaptation Feedback Parameters<a class="hash-link" href="#link-adaptation-feedback-parameters" title="Direct link to heading">​</a></h5><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_laFeedbackParams</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sint8 stfMgmtSnr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sint8 stfMsmtSnr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sint8 rssi</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 updCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> laFeedbackParams</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>stfMgmtSnr</code></td><td>The SNR measured during the short training field, in Qn format. <code>Qn = (value / 2^n)</code></td></tr><tr><td><code>stfMsmtSnr</code></td><td>The SNR measured during data packets, in Qn format. <code>Qn = (value / 2^n)</code></td></tr><tr><td><code>rssi</code></td><td>Received signal strength indication (RSSI). The measured RSSI in Q0 dBm.</td></tr><tr><td><code>updCount</code></td><td>Not used.</td></tr></tbody></table><p><em>Table 6, <code>laFeedbackParams</code> Field Desciptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="polarity">Polarity<a class="hash-link" href="#polarity" title="Direct link to heading">​</a></h4><p>Polarity refers to the timing of the transmit and receive slots relative to the
slot timing of the DN at the PoP.</p><ul><li>Even polarity represents transmit and receive slots that are synchronized with
the DN PoP.</li><li>Odd polarity represents transmit and receive slots that are opposite to that
of the DN PoP.</li></ul><p>A node that is not a PoP node receives its initial polarity information from the
Beamforming Training Request message, <code>urTrnReq</code>. See
<a href="#mac-phy-spec-beamforming-training-request">Beamforming Training Request</a>.</p><p>The PoP node receives polarity information in the Set Node Parameters message
from the E2E controller.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="association-request">Association Request<a class="hash-link" href="#association-request" title="Direct link to heading">​</a></h4><p>The initiator node sends an association request frame to begin an association
procedure with a peer node. The initiator node sends the association request
after it receives a request, from the E2E controller, to set the link status on
the peer node to Link Up.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_fbAssocReqElement</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 timestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 swTimestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 rxGolayIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 txGolayIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 frameWidth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 polarity</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 superframeSize</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 associationIndex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 respNodeType</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 controlSf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  laFeedbackParams laFbParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  VendorIeElement vndrIeEl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MeasSlotIeElement measSlotIeEl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CapsIeElement capsIeEl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PolarityIeElement polarityEl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RsnIeElement rsnIeEl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">packed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> fbAssocReqElement</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>timestamp[8]</code></td><td>Hardware timestamp. This is a byte array to avoid unaligned access.</td></tr><tr><td><code>swTimestamp[8]</code></td><td>Software timestamp offset from the hardware timestamp. This is a byte array to avoid unaligned access.</td></tr><tr><td><code>rxGolayIndex</code></td><td>Golay code index used in the receive direction, responder to initiator. When sending an association request, the initiator specifies the Golay code index used in both directions.</td></tr><tr><td><code>txGolayIndex</code></td><td>Golay code index used in the transmit direction, from initiator to responder. When sending an association request, the initiator specifies the Golay code index used in both directions.</td></tr><tr><td><code>frameWidth</code></td><td>Duration of the frame: 400 microseconds.</td></tr><tr><td><code>polarity</code></td><td>Polarity can be even (2), odd (1), or invalid (0).</td></tr><tr><td><code>superframeSize</code></td><td>Size of the superframe with the control slot allocations.</td></tr><tr><td><code>associationIndex</code></td><td>Index for the association.</td></tr><tr><td><code>respNodeType</code></td><td>CN or DN.</td></tr><tr><td><code>controlSf</code></td><td>Superframe with the control slot allocations.</td></tr><tr><td><code>laFbParams</code></td><td>See <a href="#mac-phy-spec-link-adaptation-feedback-parameters">Link Adaptation Feedback Parameters</a> for the feedback parameter field desciptions.</td></tr><tr><td><code>vndrIeEl</code></td><td>Vendor Information Element (IE) element.</td></tr><tr><td><code>measSlotIeEl</code></td><td>Measurement slot Information Element (IE) element.</td></tr><tr><td><code>polarityEl</code></td><td>Polarity Information Element (IE) element.</td></tr><tr><td><code>rsnIeEl</code></td><td>(Optional) This must be the last IE sent. This is sent only when security is enabled.</td></tr></tbody></table><p><em>Table 7, <code>fbAssocReqElement</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="association-response">Association Response<a class="hash-link" href="#association-response" title="Direct link to heading">​</a></h4><p>The responder node sends an association response frame in response to an
association request frame.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="association-response-ack">Association Response ACK<a class="hash-link" href="#association-response-ack" title="Direct link to heading">​</a></h4><p>An initiator node sends an association response acknowledgement frame to the
responder node after receipt of the association response frame from the
responder node.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_fbAssocRspAckElement</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 txSlotBitmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLOTS_IN_BWGD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 rxSlotBitmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLOTS_IN_BWGD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  laFeedbackParams laFbParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> fbAssocRspAckElement</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The slot bitmaps in the <code>ASSOC_RSP_ACK</code> message sent to a peer node indicate the
reserved (control) slots that are allocated for that peer node within the Tx and
Rx slot maps. These Tx and Rx control slots are always allocated to the peer
node within each Bandwidth Grant Duration (BWGD) and remain static throughout
the lifetime of the connection with the peer node.</p><p>The DN uses the following enumeration values to set the transmit and receive
slot bitmaps.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">_slotAttributes</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eSLOT_DATA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eSLOT_RSVD_BF </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eSLOT_RSVD_MGMT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eSLOT_RSVD_ASSOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eSLOT_RSVD_INTF_SCAN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eSLOT_RSVD_OFFLINE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> _eSlotAttributes</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>eSLOT_DATA</code></td><td>Data slot.</td></tr><tr><td><code>eSLOT_RSVD_BF</code></td><td>Slot is reserved for Beamforming.</td></tr><tr><td><code>eSLOT_RSVD_MGMT</code></td><td>Slot is reserved for Management Messaging.</td></tr><tr><td><code>eSLOT_RSVD_ASSOC</code></td><td>Slot is reserved for Association Messages.</td></tr><tr><td><code>eSLOT_RSVD_INTF_SCAN</code></td><td>Slot is reserved for Interference Scan.</td></tr></tbody></table><p><em>Table 8, <code>slotAttributes</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="heartbeat">Heartbeat<a class="hash-link" href="#heartbeat" title="Direct link to heading">​</a></h4><p>The initiator node sends a heartbeat frame once during each Bandwidth Grant
Duration (BWGD) period to update the parameters in the responder node. A DN
sends heartbeat frames only to CNs. CNs shall not send heartbeat frames.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_fbHeartbeatElement</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 timestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 swTimestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 bwgdNumber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 txSlotBitmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLOTS_IN_BWGD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 rxSlotBitmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLOTS_IN_BWGD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  laFeedbackParams laFbParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 syncMode </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 linkImpaired </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> fbHeartbeatElement</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>timestamp[8]</code></td><td>Hardware timestamp. This is a byte array to avoid unaligned access.</td></tr><tr><td><code>swTimestamp[8]</code></td><td>Software timestamp offset from the hardware timestamp. This is a byte array to avoid unaligned access.</td></tr><tr><td><code>bwgdNumber</code></td><td>Bandwidth Grant Duration (BWGD) index number, common across the network.</td></tr><tr><td><code>txSlotBitmap</code></td><td><code>[TGF_CEIL(NSF * NF * SLOTSPERFRAME, BITS_PER_BYTE)]</code></td></tr><tr><td><code>rxSlotBitmap</code></td><td><code>[TGF_CEIL(NSF * NF * SLOTSPERFRAME, BITS_PER_BYTE)]</code></td></tr><tr><td><code>laFbParams</code></td><td>See <a href="#mac-phy-spec-link-adaptation-feedback-parameters">Link Adaptation Feedback Parameters</a> for the feedback parameter field desciptions.</td></tr><tr><td><code>syncMode</code></td><td>Indicates the synchronization mode: RF or GPS.</td></tr><tr><td><code>linkImpaired</code></td><td>Indicates that the link is impaired as reported in the heartbeat message.</td></tr></tbody></table><p><em>Table 9, <code>fbHeartbeatElement</code> Field Descriptions</em></p><p>For the receive and transmit slot attributes, refer to Table 8, slotAttributes
Field Descriptions.</p><a id="mac-phy-spec-beamforming-training-request"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-training-request">Beamforming Training Request<a class="hash-link" href="#beamforming-training-request" title="Direct link to heading">​</a></h4><p>The initiator node sends a beamforming training request frame to the responder
node as part of the Beamforming Acquisition Procedure. The beamforming training
request frame has the following format:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 txbeamidx </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 frmnuminbfwin </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 frmnuminsf </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 dblpktidx </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 endtrnflag </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 polarity </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 hybrid </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 swTimestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">urTrnReq_t</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>TxBeamIdx</code></td><td>Initiator Tx Beam Index</td></tr><tr><td><code>FrmNumInBfWin</code></td><td>Frame number in BF window</td></tr><tr><td><code>FrmNumInSf</code></td><td>Frame number in SF</td></tr><tr><td><code>DblPktIdx</code></td><td>Double packet Index</td></tr><tr><td><code>EndTrnFlag</code></td><td>End of TRN flag</td></tr><tr><td><code>Polarity</code></td><td>Initiator Polarity</td></tr><tr><td><code>hybrid</code></td><td>0 = BF Normal<br>1 = BF Hybrid</td></tr><tr><td><code>swTimestamp</code></td><td>We send only 2 bytes for software timestamp. BF trn req has a duration limitation. This is used along with hw_ts in bssid+seq_num to see if the nodes are in time sync if GPS is enabled at both ends.</td></tr></tbody></table><p><em>Table 10, <code>urTrnReq_t</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-training-response">Beamforming Training Response<a class="hash-link" href="#beamforming-training-response" title="Direct link to heading">​</a></h4><p>The responder node sends the beamforming training response frame to the
initiator node after receipt of a beamforming training request frame.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 TxBeamIdx </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 RxBeamCnt </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 MissAckFlag </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 EndTrnFlag </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx01 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamLqm01 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx02 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamLqm02 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx03 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamLqm03 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx04 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamLqm04 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx05 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamLqm05 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx06 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">urTrnRes_t</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>TxBeamIdx</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>RxBeamCnt</code></td><td>Number of Decoded Rx Beams</td></tr><tr><td><code>MissAckFlag</code></td><td>Missing ACK Report</td></tr><tr><td><code>EndTrnFlag</code></td><td>End of TRN Flag</td></tr><tr><td><code>BeamIdx01</code></td><td>RxDcdBeamIdx01</td></tr><tr><td><code>BeamLqm01</code></td><td>RxDcdBeamLqm01</td></tr><tr><td><code>BeamIdx02</code></td><td>RxDcdBeamIdx02</td></tr><tr><td><code>BeamLqm02</code></td><td>RxDcdBeamLqm02</td></tr><tr><td><code>BeamIdx03</code></td><td>RxDcdBeamIdx03</td></tr><tr><td><code>BeamLqm03</code></td><td>RxDcdBeamLqm03</td></tr><tr><td><code>BeamIdx04</code></td><td>RxDcdBeamIdx04</td></tr><tr><td><code>BeamLqm04</code></td><td>RxDcdBeamLqm04</td></tr><tr><td><code>BeamIdx05</code></td><td>MissAckRxBeam</td></tr><tr><td><code>BeamLqm05</code></td><td>MissAckLqm</td></tr><tr><td><code>BeamIdx06</code></td><td>MissAckTxBeam</td></tr></tbody></table><p><em>Table 11, <code>urTrnRes_t</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-training-response-ack">Beamforming Training Response ACK<a class="hash-link" href="#beamforming-training-response-ack" title="Direct link to heading">​</a></h4><p>The initiator node sends the beamforming training response ACK frame to the
responder node, to identify the beam index used for transmission by the
responder when transmitting to the initiator. The frame also includes a field to
indicate the conclusion of the beamforming procedure.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 TxBeamIdx </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 EndTrnFlg </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 TrnRspLqm </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">urTrnResAck_t</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>TxBeamIdx</code></td><td>ACK Tx Beam Index</td></tr><tr><td><code>EndTrnFlg</code></td><td>End of Training Flag</td></tr><tr><td><code>TrnRspLqm</code></td><td>TRN response Link Quality Metric</td></tr></tbody></table><p><em>Table 12, <code>urTrnResAck_t</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-micro-route-exchange">Beamforming Micro-route Exchange<a class="hash-link" href="#beamforming-micro-route-exchange" title="Direct link to heading">​</a></h4><p>Both the initiator and responder nodes send the beamforming micro-route exchange
frame at the conclusion of the beamforming process.</p><ul><li>The initiator node sends the frame using the beamforming order request.</li><li>The responder sends the frame using the beamforming order response after
receiving the beamforming order request from the initiator.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-order-request">Beamforming Order Request<a class="hash-link" href="#beamforming-order-request" title="Direct link to heading">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 uRouteCnt </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx01 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx02 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx03 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx04 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx05 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx06 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx07 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx08 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx09 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx10 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx11 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx12 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx13 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx14 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx15 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamidx16 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 beamlqm </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sint8 rssi</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">urOrdReq_t</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>uRouteCnt</code></td><td>Number of uRoutes</td></tr><tr><td><code>BeamIdx01</code></td><td>Initiator Tx Beam Index 1</td></tr><tr><td><code>BeamIdx02</code></td><td>Responder Rx Beam Index 2</td></tr><tr><td><code>BeamIdx03</code></td><td>Initiator Tx Beam Index 3</td></tr><tr><td><code>BeamIdx04</code></td><td>Responder Rx Beam Index 4</td></tr><tr><td><code>BeamIdx05</code></td><td>Initiator Tx Beam Index 5</td></tr><tr><td><code>BeamIdx06</code></td><td>Responder Rx Beam Index 6</td></tr><tr><td><code>BeamIdx07</code></td><td>Initiator Tx Beam Index 7</td></tr><tr><td><code>BeamIdx08</code></td><td>Responder Rx Beam Index 8</td></tr><tr><td><code>BeamIdx09</code></td><td>Initiator Tx Beam Index 9</td></tr><tr><td><code>BeamIdx10</code></td><td>Responder Rx Beam Index 10</td></tr><tr><td><code>BeamIdx11</code></td><td>Initiator Tx Beam Index 11</td></tr><tr><td><code>BeamIdx12</code></td><td>Responder Rx Beam Index 12</td></tr><tr><td><code>BeamIdx13</code></td><td>Initiator Tx Beam Index 13</td></tr><tr><td><code>BeamIdx14</code></td><td>Responder Rx Beam Index 14</td></tr><tr><td><code>BeamIdx15</code></td><td>Initiator Tx Beam Index 15</td></tr><tr><td><code>BeamIdx16</code></td><td>Responder Rx Beam Index 16</td></tr><tr><td><code>BeamLqm</code></td><td>Best R-&gt;I LQM</td></tr><tr><td><code>Rssi</code></td><td>Received signal strength indication (RSSI). The measured RSSI in Q0 dBm.</td></tr></tbody></table><p><em>Table 13, <code>urOrdReq_t</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-order-response">Beamforming Order Response<a class="hash-link" href="#beamforming-order-response" title="Direct link to heading">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 uRouteCnt </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx01 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx02 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx03 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx04 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx05 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx06 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx07 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx08 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx09 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx10 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx11 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx12 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx13 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx14 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx15 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamIdx16 </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint32 BeamLqm </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sint8 rssi</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">urOrdRes_t</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>uRouteCnt</code></td><td>Number of uRoutes</td></tr><tr><td><code>BeamIdx01</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx02</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx03</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx04</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx05</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx06</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx07</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx08</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx09</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx10</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx11</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx12</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx13</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx14</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamIdx15</code></td><td>Responder Tx Beam Index</td></tr><tr><td><code>BeamIdx16</code></td><td>Initiator Rx Beam Index</td></tr><tr><td><code>BeamLqm</code></td><td>Best I-&gt;R LQM</td></tr><tr><td><code>rssi</code></td><td>Received signal strength indication (RSSI). The measured RSSI in Q0 dBm.</td></tr></tbody></table><p><em>Table 14, <code>urOrdRes_t</code> Field Descriptions</em></p><a id="mac-phy-spec-beamforming-association-indication"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-association-indication">Beamforming Association Indication<a class="hash-link" href="#beamforming-association-indication" title="Direct link to heading">​</a></h4><p>A Destination Node (DN) sends a Beamforming Association Indication
(<code>bfAssocInd</code>) frame periodically to all of its peer DNs to indicate its
beamforming association status.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">_bfAssocIndication</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BFIND_NONE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BFIND_ASSOC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BFIND_BF_INITIATOR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BFIND_BF_RESPONDER </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BFIND_BF_INTF_SCAN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> bfAssocInd</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>BFIND_NONE</code></td><td>Peer DN is not doing beamforming association.</td></tr><tr><td><code>BFIND_ASSOC</code></td><td>Peer DN is doing beamforming association.</td></tr><tr><td><code>BFIND_BF_INITIATOR</code></td><td>Peer DN is doing beamforming as a beamforming initiator.</td></tr><tr><td><code>BFIND_BF_RESPONDER</code></td><td>Peer DN is doing beamforming as a beamforming responder.</td></tr><tr><td><code>BFIND_BF_INTF_SCAN</code></td><td>Peer DN is doing interference scan.</td></tr></tbody></table><p><em>Table 15, <code>bfAssocInd</code> Field Descriptions</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="keep-alive">Keep Alive<a class="hash-link" href="#keep-alive" title="Direct link to heading">​</a></h4><p>A Destination Node (DN) sends Keep Alive frames periodically to all of its
connected DNs to indicate that it is alive and able to communicate.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_fbKeepaliveElement</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 timestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 swTimestamp</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 bwgdNumber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 bfAssocIndication</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 reserved</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLOTS_IN_BWGD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 finalRxSlotBitmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SLOTS_IN_BWGD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 rsvdMgmtBitmap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">TGF_CEIL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NSF</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BITS_PER_BYTE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  laFeedbackParams laFbParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 syncMode </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 linkImpaired </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l2SchedulerStats l2SchedStats</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> fbKeepaliveElement</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Type</strong></th><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>usint8</td><td><code>timestamp[8]</code></td><td>Hardware timestamp. This is a byte array to avoid unaligned access.</td></tr><tr><td>usint8</td><td><code>swTimestamp[8]</code></td><td>Software timestamp offset from the hardware timestamp. This is a byte array to avoid unaligned access.</td></tr><tr><td>usint16</td><td><code>bwgdNumber</code></td><td>Bandwidth Grant Duration (BWGD) index number, common across the network.</td></tr><tr><td>usint8</td><td><code>bfAssocIndication</code></td><td>See <a href="#mac-phy-spec-beamforming-association-indication">Beamforming Association Indication</a> Indication.</td></tr><tr><td>usint8</td><td><code>reserved</code></td><td><code>[TGF_CEIL(SLOTS_IN_BWGD, BITS_PER_BYTE)]</code></td></tr><tr><td>usint8</td><td><code>finalRxSlotBitmap</code></td><td><code>[TGF_CEIL(SLOTS_IN_BWGD, BITS_PER_BYTE)]</code></td></tr><tr><td>usint8</td><td><code>rsvdMgmtBitmap[]</code></td><td><code>[TGF_CEIL(NSF, BITS_PER_BYTE)]</code></td></tr><tr><td>laFeedbackParams</td><td><code>laFbParams</code></td><td>See <a href="#mac-phy-spec-link-adaptation-feedback-parameters">Link Adaptation Feedback Parameters</a>.</td></tr><tr><td>usint8</td><td><code>syncMode</code></td><td>Indicates the synchronization mode: RF or GPS.</td></tr><tr><td>usint8</td><td><code>linkImpaired</code></td><td>Indicates that the link is impaired as reported in the heartbeat message.</td></tr><tr><td>usint8</td><td><code>l2SchedStats</code></td><td>See <a href="#mac-phy-spec-layer-2-scheduler-statistics">Layer 2 Scheduler Statistics</a>.</td></tr></tbody></table><p><em>Table 16, <code>fbKeepaliveElement</code> Field Descriptions</em></p><p>For the receive and transmit slot attributes, refer to Table 8, slotAttributes
Field Descriptions.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disassociation">Disassociation<a class="hash-link" href="#disassociation" title="Direct link to heading">​</a></h4><p>A node sends the disassociation frame to terminate communication with the
recipient node. The state of the link after sending the disassociation frame is
Link Down. This message has no content.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fb-uplink-bandwidth-element">FB Uplink Bandwidth Element<a class="hash-link" href="#fb-uplink-bandwidth-element" title="Direct link to heading">​</a></h4><p>A responder node sends the uplink bandwidth request to an initiator node to
indicate the aggregated state of traffic arriving from downstream. A responder
node sends this frame as required to change the bandwidth grant received from
the upstream node. A CN sends this frame only to a DN. A DN shall not send this
frame.</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_fbUplinkBwReqElement</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l2SchedulerStats l2SchedStats</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  laFeedbackParams laFbParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 linkImpaired </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> fbUplinkBwReqElement</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>l2SchedStats</code></td><td>See <a href="#mac-phy-spec-layer-2-scheduler-statistics">Layer 2 Scheduler Statistics</a>.</td></tr><tr><td><code>laFbParams</code></td><td>See <a href="#mac-phy-spec-link-adaptation-feedback-parameters">Link Adaptation Feedback Parameters</a>.</td></tr><tr><td><code>linkImpaired</code></td><td>Indicates that the link is impaired as reported in the heartbeat message.</td></tr></tbody></table><p><em>Table 17, <code>fbUplinkBwReqElement</code> Field Description</em></p><a id="mac-phy-spec-layer-2-scheduler-statistics"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="layer-2-scheduler-statistics-1">Layer 2 Scheduler Statistics<a class="hash-link" href="#layer-2-scheduler-statistics-1" title="Direct link to heading">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">_l2SchedulerStats</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 queueSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint16 arrivalRate</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usint8 mcs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">__attribute__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__packed__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> l2SchedulerStats</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th><strong>Field</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>queueSize</code></td><td>Queue size (in 256-byte units)</td></tr><tr><td><code>arrivalRate</code></td><td>Arrival rate (in units of 128 Kbps or 16 bytes/ms)</td></tr><tr><td><code>mcs</code></td><td>MCS value</td></tr></tbody></table><p><em>Table 18, <code>l2SchedulerStats</code> Field Descriptions</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="channel-access-mechanism">Channel Access Mechanism<a class="hash-link" href="#channel-access-mechanism" title="Direct link to heading">​</a></h2><p>Terragraph uses a time division duplex (TDD) channel access mechanism.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="timing-and-tdd-access-mechanism">Timing and TDD Access Mechanism<a class="hash-link" href="#timing-and-tdd-access-mechanism" title="Direct link to heading">​</a></h3><p>All Terragraph nodes are time synchronized. Time synchronization is achieved
through GPS, IEEE 1588, or some other reliable mechanism external to the MAC.
Each sector of a node is assigned specific times during which it can transmit or
receive.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="frames-slots-subframes-and-superframes">Frames, Slots, Subframes, and Superframes<a class="hash-link" href="#frames-slots-subframes-and-superframes" title="Direct link to heading">​</a></h3><p>The Terragraph MAC uses a hierarchical structure of items to exchange
information between nodes. The smallest item used is the slot. A slot is
unidirectional between a single sender and a single receiver. A slot has a fixed
duration. A fixed number of slots are collected together to form a subframe.</p><p>A subframe is also unidirectional. From the point of view of a node, a subframe
is either a transmit subframe or a receive subframe. When a single node is
transmitting to multiple receivers, each receiver is assigned to its own slot.
When a single node is receiving from multiple transmitters, each transmitter is
assigned to its own slot.</p><p>Combining one transmit subframe and one receive subframe results in a TDD frame.
A TDD frame is not to be mistaken with an 802.11 frame or PPDU. A superframe
combines four TDD frames. Figure 2 shows the relationship of these structures.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/TDD_Frame_Structure.png" width="600" class="img_ev3q"><br><em>Figure 2, TDD Frame Structure</em></p><a id="mac-phy-spec-slot-timing"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="slot-timing">Slot Timing<a class="hash-link" href="#slot-timing" title="Direct link to heading">​</a></h3><p>The timing constraints on transmit and receive slots are demanding, in order to
provide high capacity frame exchanges. By design, transmit slots are assigned to
a sending node that aligns with receive slots assigned to a recipient node.</p><p>There are start and end offsets at the beginning and end of each slot, to
provide time for the transmitter to change radio parameters for each
destination, if necessary. The receive slot is longer than the transmit slot.
The longer receive slot accommodates for small differences in timing without
loss of data. The receive slot surrounds the transmit slot. See Figure 3 and
Figure 4.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/Tx_Rx_Slot_Relationship.png" width="400" class="img_ev3q"><br><em>Figure 3, Transmit and Receive Slot Relationship</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="timing-unit-durations">Timing Unit Durations<a class="hash-link" href="#timing-unit-durations" title="Direct link to heading">​</a></h4><p>The following timing unit durations are defined by Terragraph for use by the
MAC:</p><ul><li><strong>Bandwidth Grant Duration (BWGD)</strong> − comprised of 16 superframes</li><li><strong>Superframe</strong> − comprised of four frames</li><li><strong>Frame</strong> − comprised of two subframes</li><li><strong>Subframe</strong> − comprised of three slots</li><li><strong>Slot</strong></li></ul><p>The subframe unit is the bases for all the other timing units. The other timing
unit durations are derived from the subframe timing unit duration, which is
200μs. Figure 4 shows a transmit and receive subframe.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/Tx_Rx_Subframes.png" width="800" class="img_ev3q"><br><em>Figure 4, Transmit and Receive Subframes</em></p><p>The timing requirements of transmit and receive slots are as follows:</p><table><thead><tr><th><strong>Slot</strong></th><th><strong>Start Offset (μs)</strong></th><th><strong>End Offset (μs)</strong></th></tr></thead><tbody><tr><td>Tx Slot 0</td><td>2</td><td>86</td></tr><tr><td>Tx Slot 1</td><td>96</td><td>177</td></tr><tr><td>Tx Slot 2</td><td>187</td><td>192</td></tr><tr><td>Rx Slot 0</td><td>0</td><td>86</td></tr><tr><td>Rx Slot 1</td><td>94</td><td>177</td></tr><tr><td>Rx Slot 2</td><td>185</td><td>192</td></tr></tbody></table><p><em>Table 19, Transmit and Receive Slot Timing Requirements</em></p><p>When a node has a frame to transmit, it begins transmission at the beginning of
the slot duration of the slot allocated to it for transmission. The MAC may
combine adjacent slots to maximize airtime by removing the guard times between
those slots. Specifically, the MAC may combine the following slots:</p><ul><li>Slots 0 and 1</li><li>Slots 1 and 2</li><li>Slots 0, 1, and 2</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terragraph-mac-procedures">Terragraph MAC Procedures<a class="hash-link" href="#terragraph-mac-procedures" title="Direct link to heading">​</a></h2><p>During Terragraph network operation, the Terragraph MAC may perform the
following procedures:</p><ul><li>Frame Aggregation</li><li>Time Synchronization</li><li>Frame Synchronization</li><li>Scanning</li><li>Beamforming</li><li>Association</li><li>Block acknowledgement</li><li>Management Frame Transmission</li><li>Simple Acknowledgement</li><li>Retransmission</li><li>Bandwidth Allocation</li><li>Data Transfer</li><li>Traffic Scheduling</li><li>Link Adaptation</li><li>Link Measurement</li><li>Link Loss Detection</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="frame-aggregation">Frame Aggregation<a class="hash-link" href="#frame-aggregation" title="Direct link to heading">​</a></h3><p>Terragraph uses both MSDU and MPDU aggregation for efficiency.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="time-synchronization">Time Synchronization<a class="hash-link" href="#time-synchronization" title="Direct link to heading">​</a></h3><p>The MAC synchronizes its timers to an external, accurate time source, such as
GPS or IEEE 1588. A timing pulse that resets the Timing Synchronization Function
(TSF) on the DN is repeated once every second. This timing pulse occurs exactly
on the turn of each second.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="proprietary-pre-11ay-time-synchronization">Proprietary (pre-11ay) Time Synchronization<a class="hash-link" href="#proprietary-pre-11ay-time-synchronization" title="Direct link to heading">​</a></h4><p>Proprietary (pre-11ay) time synchronization uses the <code>syncMode</code> field in the
Heartbeat and Keepalive messages. Both the Keepalive (DN to DN) and Heartbeat
(DN to CN) messages have a 1-bit field named <code>syncMode</code>:</p><ul><li><code>syncMode = 1</code>: The transmitting station (STA) does <em>not</em> have access to a
local source of timing (local clock) at the time of sending the message and
uses received timestamps for time synchronization as long as a local clock is
unavailable.</li><li><code>syncMode = 0</code>: The transmitting STA has access to a local clock and is using
the local clock at the time of sending the message. The transmitting STA will
ignore incoming timestamps as long as the local clock is available.</li></ul><p>(In the current implementation, the CN ignores the <code>syncMode</code> bit in the
Heartbeat message.)</p><p>Using a local clock includes holdover periods that occur when a timing source
(such as GNSS) becomes temporarily unavailable for short periods, but the timing
drift is still within the system time error tolerance.</p><p>When a DN or CN with <code>syncMode = 1</code> joins a network and receives a Terragraph
Proprietary Association Request message (<code>_fbAssocReqElement</code>), the DN or CN
sets its local time to the time of the received timestamp. The DN or CN ignores
the received timestamp if it has access to a local clock.</p><p>A DN that does not have access to a local clock and receives a Keepalive or
Heartbeat message with <code>syncMode = 0</code>, increments or decrements the local time
by 1 µs toward the received timestamp. There is no limit to the total amount of
correction. The rate of correction is limited, by the number of Keepalive or
Heartbeat messages, to ±39-40 µs per second.</p><p>A DN that does not have access to a local clock, and receives a Keepalive or
Heartbeat message with <code>syncMode = 1</code>, will bring down the link by sending a
Terragraph Proprietary Disassociation message (proprietary action frame with
<code>actionCode = DISASSOC_REQ = 9</code>) to the other DN. After this point, the link can
be brought up through initial beamforming.</p><p>The peer DNs will not generate any packets to each other after this point, and
the link can be brought up only through initial beamforming.</p><p><strong>Note:</strong> The Terragraph Proprietary Association Request message does not have a
<code>syncMode</code> field.</p><p>This behavior is link-local. It is enforced between two peer DNs, regardless of
each DN&#x27;s connectivity to other peer DNs. For example, assume a DN (DN1) has two
peers: DN2 and DN3. If DN1 does not have access to a local clock, and it
receives a Keepalive message from DN2 with <code>syncMode = 1</code>, DN1 will bring down
its link with DN2, even if DN1 is still receiving Keepalive messages from DN3
with <code>syncMode = 0</code>.</p><p>When a DN brings down all of its links to its peer DNs, it also sends a
DISASSOC_REQ message to all of its CNs to bring down the CNs as well.</p><p>The <code>DISASSOC_REQ</code> message is transmitted as a low-priority management message
in regular data slots if the association procedure has been completed (the link
is in the <code>LINK_UP</code> state). When necessary, the <code>DISASSOC_REQ</code> message is
transmitted as a high-priority management message in BF slots during association
(as long the link is not in the <code>LINK_UP</code> state).</p><p>It is possible to see some Rx and Tx packets after a link is brought down
because of the residual packets in the queue or the transient states of some
packets.</p><p>To summarize, an operational DN can be at most 1 hop, and a CN can be at most 2
wireless hops, away from an accurate source of timing (such as GNSS in
Terragraph). Otherwise, all links incident on the sector will be brought down.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="frame-synchronization">Frame Synchronization<a class="hash-link" href="#frame-synchronization" title="Direct link to heading">​</a></h3><p>Frame synchronization between nodes uses either GPS time or the TSF timer as the
source for its timing. When present, the 1 PPS signal resets the TSF timer to
zero once per second, at the beginning of each second. Frames begin every 200μS.</p><p>If GPS time is not present, the TSF timer adopts its value from the timestamp in
the frames from an upstream node.</p><ul><li>For a DN, the TSF timer adopts the value of the timestamp in the association
request and Keep Alive frames.</li><li>For a CN, the TSF timer adopts the value of the timestamp in the association
request, heartbeat, and beamforming training request frames.</li></ul><p>The first slot of a superframe begins when the TSF timer value is zero.
Subsequent slots begin as determined by the summing of the beginning guard time,
slot duration, and ending guard time. Refer to Table 4, fbACtionType Field
Descriptions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scanning">Scanning<a class="hash-link" href="#scanning" title="Direct link to heading">​</a></h3><p>The MAC synchronizes its timers to an external, accurate time source, such as
GPS or IEEE 1588.</p><p>A timing pulse that resets the Timing Synchronization Function (TSF) on the DN
is repeated once every second. This timing pulse shall occur exactly on the turn
of each second.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming">Beamforming<a class="hash-link" href="#beamforming" title="Direct link to heading">​</a></h3><p>The Beamforming Acquisition Procedure is specified in
<a href="/docs/developer/Beamforming_Link_Adaptation">Beamforming and Link Adaptation</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="association">Association<a class="hash-link" href="#association" title="Direct link to heading">​</a></h3><p>Association is the process of exchanging parameters between nodes to establish a
channel for communication. A node uses the association procedure after
beamforming is complete and before attempting to transmit data frames to another
node.</p><p>An initiator node begins the association procedure by sending an association
request frame to the responder node. Upon receipt of the association request
frame, the responder node responds to the initiator with an association response
frame.</p><p>The initiator node acknowledges the receipt of the association response frame
and concludes the association procedure by transmitting an association
acknowledgement frame to the responder.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="block-acknowledgement">Block acknowledgement<a class="hash-link" href="#block-acknowledgement" title="Direct link to heading">​</a></h3><p>Block acknowledgement is used by a single node to send acknowledgement frames to
multiple nodes at once. The block acknowledgement procedure does not use the
ADDBA/DELBA setup procedure defined in IEEE 802.11-2016. The block
acknowledgement procedure uses a reorder buffer with a fixed size of 64 frames.
The Block ACK frame uses a compressed bitmap.</p><p>A node uses the Block ACK frame to acknowledge aggregated MPDUs from multiple
nodes (A-MPDUs). The node sends a Block ACK frame during the first transmit slot
assigned to allow the node to transmit to the source of the frames being
acknowledged. The Block ACK frame may appear at any time during the first
transmit slot. Terragraph nodes shall not transmit or respond to the Block ACK
Request frame.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="management-frame-transmission">Management Frame Transmission<a class="hash-link" href="#management-frame-transmission" title="Direct link to heading">​</a></h3><p>A node will transmit and retransmit one management frame to a single destination
node until the destination node acknowledges receipt of the management frame or
the retransmission process is terminated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="simple-acknowledgement">Simple Acknowledgement<a class="hash-link" href="#simple-acknowledgement" title="Direct link to heading">​</a></h3><p>A node may use simple acknowledgement to acknowledge any management frame that
it receives. When a node receives a frame that requires a simple
acknowledgement, the node sends an ACK frame during the first transmit slot
assigned to allow the node to transmit to the source of the frames being
acknowledged.</p><p>If an ACK frame is not received in the first slot, the node expecting the ACK
frame considers the corresponding management frame transmission to have failed.
The node then uses the retransmission process to attempt to deliver the
management frame.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retransmission">Retransmission<a class="hash-link" href="#retransmission" title="Direct link to heading">​</a></h3><p>When a data frame or management frame fails acknowledgement, the node
retransmits the failed frame. The Node retransmits a failed A-MPDU as described
in IEEE 802.11-2016, clause 10.24.7.7.</p><p>A node retransmits the failed management frames in the next slot that is
allocated to the node. The maximum number of retransmissions allowed is two.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bandwidth-allocation">Bandwidth Allocation<a class="hash-link" href="#bandwidth-allocation" title="Direct link to heading">​</a></h3><p>The Terragraph MAC allocates bandwidth for a period known as the Bandwidth Grant
Duration (BWGD). The unit of measurement for the BWGD is the superframe. One
BWGD comprises 16 superframes.</p><p>The bandwidth allocation for a DN or CN is constant. A CN shall request an
allocation of bandwidth using the Uplink Bandwidth Request frame. Upon receipt
and processing of the Uplink Bandwidth Request, the DN shall respond with a new
bandwidth allocation, during the Heartbeat frame. The bandwidth allocation that
is granted may differ from the requested bandwidth.</p><p>The MAC shall allocate a fixed number of slots as control slots, for each peer
node. Control slots are allocated in pairs, one in the transmit direction and
the corresponding slot in the receive direction. See
<a href="#mac-phy-spec-slot-allocation">Slot Allocation</a>.</p><p>A DN sector can communicate with up to 2 other DNs and up to 256 CNs. The
Terragraph MAC allocates bandwidth for each DN with which it communicates and a
bandwidth segment for all CNs with which it communicates.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="static-bandwidth-allocation">Static Bandwidth Allocation<a class="hash-link" href="#static-bandwidth-allocation" title="Direct link to heading">​</a></h4><p>A node receives its initial static bandwidth allocation from the Association
Response Acknowledgement frame, where the transmit and receive slot bitmaps
indicate which control slots are allocated to the node. The node sending the
Association Response Acknowledgement frame, the initiator node, shall select
which control slots are allocated for the newly associated peer node, as
described in <a href="#mac-phy-spec-slot-allocation">Slot Allocation</a>. The node
receiving the transmit and receive slot bitmaps uses these control slots in the
next BWGD.</p><p>A DN shall update the transmit and receive slot bitmaps, that it receives from
the Heartbeat frame, with the new control slots, and transmits the updated slot
bitmaps in the next Heartbeat frame. A DN shall not populate the transmit and
receive slot bitmaps in the Keep Alive frame for static bandwidth allocation.
DNs shall ignore the transmit and receive slot bitmaps in the Keep Alive frames
for static bandwidth allocation.</p><p>The E2E controller allocates additional slots at the MAC layer using the
<code>NodeBwAlloc</code> structure in the Node Parameters Message.</p><p>The E2E controller directs the use of slots by designating them as follows:</p><ul><li>Reserved for management</li><li>Reserved for beamforming</li><li>Unreserved</li></ul><p>When a node receives a Node Parameters Message, it designates the slots
identified in the <code>NodeBwAlloc</code> structure as unreserved. The node uses the Link
ID for the transmission and reception of data frames and management frames, to
associate the slots with the MAC address of a sector.</p><p>A DN will continue to use the <code>NodeBwAlloc</code> structure to identify control slots
while the network is operating. The E2E controller sends the Node Parameters
Message to the DNs at both ends of a link. The E2E controller sends the Node
Parameters Message only to DNs.</p><p>Upon receipt of the Node Parameters Message in the current BWGD, a DN shall
prepare the transmit and receive slot bitmaps for inclusion in the Heartbeat
frame that is sent to a CN. The MAC sends the new transmit and receive slot maps
in the Heartbeat frame during the next BWGD.</p><p>When a CN receives transmit and receive slot bitmaps in a Heartbeat frame, or
when a DN receives a Node Parameters Message, the CN or DN shall adopt those
slot bitmaps and uses them in the next BWGD. For static bandwidth allocation,
the turnaround time for a new slot bitmap is 2 BWGDs, as shown in Figure 6.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/Static_BW_Alloc.png" width="900" class="img_ev3q"><br><em>Figure 6, Static Bandwidth Allocation</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-bandwidth-allocation">Dynamic Bandwidth Allocation<a class="hash-link" href="#dynamic-bandwidth-allocation" title="Direct link to heading">​</a></h4><p>The Link Level Scheduler (LLS) begins the dynamic bandwidth allocation process
using the initial static slot allocations from the Association Response
Acknowledgement frame. From this initial condition, the LLS performs dynamic
bandwidth allocation, using the minimum, maximum, and ideal airtime allocations
received from the E2E controller for:</p><ul><li>Each peer node in the NodeAirtime structure of the Node Parameters Message</li><li>Arrival rate of data for each peer node</li><li>Local queue length for the peer node</li></ul><p>The MAC allocates dynamic bandwidth, beyond the initial control slot allocation,
using the unreserved slots in the Node Parameters Message from the E2E
controller.</p><p>During the BWGD, a DN shall prepare a transmit slot bitmap for inclusion in the
Keep Alive frames and in both the transmit and receive slot bitmaps, which will
be sent in Heartbeat frames to the peer DNs and CNs. The MAC sends the new slot
bitmaps in the Keep Alive frames and Heartbeat frames during the next BWGD.</p><p>A node receiving Keep Alive or Heartbeat frames prepares a receive slot bitmap
for inclusion in the Keep Alive frames and the Uplink Bandwidth Request frame.
The MAC sends the new receive slot bitmap in the Keep Alive frame or the Uplink
Bandwidth Request frame during the next BWGD.</p><p>The DN receiving the receive slot map prepares the combined transmit and receive
slot maps for inclusion in the Keep Alive and Heartbeat frames to be sent to the
peer DNs and CNs. The MAC sends the combined transmit and receive slot maps in
the Keep Alive and Heartbeat frames in the next BWGD.</p><p>The MAC shall adopt the combined slot maps received in the Keep Alive or
Heartbeat frame in the BWGD following the receipt of the frame. For dynamic
bandwidth allocation, the turnaround time for a new slot map is 3 BWGDs, as
shown in Figure 7.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/Dynamic_BW_Alloc.png" width="900" class="img_ev3q"><br><em>Figure 7, Dynamic Bandwidth Allocation</em></p><a id="mac-phy-spec-slot-allocation"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="slot-allocation">Slot Allocation<a class="hash-link" href="#slot-allocation" title="Direct link to heading">​</a></h4><p>The MAC allocates slots for the associated DNs and CNs for one complete BWGD. At
a minimum, the MAC allocates a single, fixed slot per frame, in two superframes,
for each link to an associated node.</p><p>The MAC uses this fixed allocation to transmit Keep Alive, Heartbeat, and Uplink
Bandwidth Request frames, guaranteeing a minimum bandwidth allocation to each
link. The slot assigned for this purpose is the final slot of a frame.</p><p>When the fixed slot assigned is not required to transmit the Keep Alive,
Heartbeat, or Uplink Bandwidth Request frames, the MAC can use the slot for
transmission of other management frames or data.</p><p>The MAC allocates fixed slots, called control slots, to associated nodes in the
Association Response Acknowledgement Message as follows:</p><ul><li><em>SFi</em> represents Superframe <em>i</em>. <em>NSF</em> is the number of superframes in a BWGD.
<em>n</em> is the number of associated DNs. <em>m</em> is the number of associated CNs.</li><li>For <em>DNi</em>, where <em>i=<!-- -->[1,n]</em>: assign the last slot of each frame in <em>SFi</em> and
<em>SFNSF/2 + i</em> to <em>DNi</em>.</li><li>For <em>CNi</em>, where <em>i=<!-- -->[1,m]</em>: assign the last slot of each frame in <em>SFi + n</em>
and <em>SFNSF/2 + i + n</em> to <em>CNi</em>.</li></ul><p>Figure 8 illustrates the fixed slot assignments for one associated DN and three
associated CNs.</p><p align="center"><img loading="lazy" src="/figures/mac_phy/Fixed_Slot_Assignment.png" width="700" class="img_ev3q"><br><em>Figure 8, Example of Fixed Slot Assignment</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="remaining-slot-allocation">Remaining Slot Allocation<a class="hash-link" href="#remaining-slot-allocation" title="Direct link to heading">​</a></h4><p>The MAC allocates slots differently, depending on the use of the static
bandwidth allocation method or dynamic bandwidth allocation method.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="static-slot-allocation">Static Slot Allocation<a class="hash-link" href="#static-slot-allocation" title="Direct link to heading">​</a></h4><p>The MAC allocates the slots remaining after the fixed slot allocation only as
directed in the slot maps received in the Node Parameters Message from the E2E
controller.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-slot-allocation">Dynamic Slot Allocation<a class="hash-link" href="#dynamic-slot-allocation" title="Direct link to heading">​</a></h4><p>For dynamic slot allocation, the MAC allocates the slots remaining after the fix
slot allocation according to the following algorithm that attempts to satisfy
these constraints:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><msub><mtext>MCS</mtext><mi>l</mi></msub><msub><mi>T</mi><mi>l</mi></msub></mrow><msub><mi>Q</mi><mi>l</mi></msub></mfrac><mo>=</mo><mfrac><mrow><msub><mtext>MCS</mtext><msub><mi>l</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub></msub><msub><mi>T</mi><msub><mi>l</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub></msub></mrow><msub><mi>Q</mi><mi>l</mi></msub></mfrac><mo separator="true">,</mo><mrow><mtext> </mtext><mi mathvariant="bold">∀</mi></mrow><mi>l</mi><mo separator="true">,</mo><mtext> </mtext><msup><mi>l</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msup><mo separator="true">,</mo><mtext> such that </mtext><msub><mi>Q</mi><mi>l</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>Q</mi><msup><mi>l</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msub><mtext> </mtext><mo mathvariant="normal">≠</mo><mtext> </mtext><mn>0</mn></mrow><annotation encoding="application/x-tex">\frac{\text{MCS}_{l}T_{l}}{Q_{l}} = \frac{\text{MCS}_{l_{&#x27;}}T_{l_{&#x27;}}}{Q_{l}},\mathbf{\ \forall}l,\ l^{&#x27;},\ \text{such\ that}\ Q_{l},\ Q_{l&#x27;}\ \neq \ 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.2872em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4068em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.7234em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3448em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.6068em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8496em"><span style="top:-2.8496em;margin-right:0.1em"><span class="pstrut" style="height:2.5556em"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.262em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3334em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3448em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.6068em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8496em"><span style="top:-2.8496em;margin-right:0.1em"><span class="pstrut" style="height:2.5556em"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.262em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3334em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mspace"> </span><span class="mord mathbf">∀</span></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9925em"><span style="top:-2.9925em;margin-right:0.05em"><span class="pstrut" style="height:2.5795em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em"><span style="top:-2.931em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord text"><span class="mord">such that</span></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em"><span style="top:-2.786em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munderover><mo>∑</mo><mrow></mrow><mrow></mrow></munderover><msub><mi>T</mi><mi>l</mi></msub><mo>≤</mo><mtext> </mtext><mi>A</mi><mi>v</mi><mi>a</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext> </mtext><mi>S</mi><mi>l</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\sum_{}^{}T_{l} \leq \ Available\ Slot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.6em;vertical-align:-1.25em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.35em"><span style="top:-1.9em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">ai</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">ab</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.01968em">Sl</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span></span></span></span></span></div><p>Where <em>MCSl</em> is the MCS for link <em>l</em>, Tl is the allocated slot time for link
<em>l</em>, and Ql is the queue depth for link <em>l</em>.</p><p><strong>Step 1.</strong> During the kth BWGD, speculatively estimate the queue size for
the third following BWGD:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">[</mo><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mn>3</mn><mo>×</mo><msub><mi>I</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Q_{l}(k + 3) = max\lbrack Q_{l}(k) - D_{l}(k) - D_{l}(k + 1) - D_{l}(k + 2) + 3 \times I_{l}(k),0\rbrack</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></div><p>Where <em>Dl(n)</em> represents the departed (served) traffic for link <em>l</em> during BWGD
<em>n</em> and <em>Il(n)</em> represents the arriving traffic during BWGD <em>n</em>.</p><p><strong>Step 2.</strong> For all links where</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn><mo separator="true">,</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mtext> </mtext><msub><mi>T</mi><mi>l</mi></msub><mo>=</mo><msub><mi>T</mi><mrow><msub><mi>l</mi><mi>min</mi><mo>⁡</mo></msub><mtext> </mtext></mrow></msub><mtext>and update </mtext><msub><mi>T</mi><mtext>total</mtext></msub><mo>=</mo><msub><mi>T</mi><mtext>total</mtext></msub><mo>−</mo><msub><mi>T</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">Q_{l}(k + 3) = 0,assign\ T_{l} = T_{l_{\min}\ }\text{and\ update\ }T_{\text{total}} = T_{\text{total}} - T_{l}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">ss</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9445em;vertical-align:-0.2501em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.334em"><span style="top:-2.357em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em"><span></span></span></span></span></span></span><span class="mord text"><span class="mord">and update </span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span></div><p><strong>Step 3.</strong> For any link <em>l</em>, such that</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><mrow><msub><mtext>MCS</mtext><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>≤</mo><msub><mi>T</mi><msub><mi>l</mi><mtext>ideal</mtext></msub></msub><mtext> assign </mtext><msub><mi>T</mi><mi>l</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><mrow><msub><mtext>MCS</mtext><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac><mtext> and update </mtext><msub><mi>T</mi><mtext>total</mtext></msub><mo>=</mo><msub><mi>T</mi><mtext>total</mtext></msub><mo>−</mo><msub><mi>T</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">\frac{Q_{l}(k + 3)}{\text{MCS}_{l}(k)} \leq T_{l_{\text{ideal}}}\text{\ assign\ }T_{l} = \frac{Q_{l}(k + 3)}{\text{MCS}_{l}(k)}\text{\ and\ update\ }T_{\text{total}} = T_{\text{total}} - T_{l}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9392em;vertical-align:-0.2559em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3488em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ideal</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2559em"><span></span></span></span></span></span></span><span class="mord text"><span class="mord"> assign </span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord text"><span class="mord"> and update </span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span></div><p><strong>Step 4.</strong> For all remaining links, calculate</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>l</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><msub><mtext>MCS</mtext><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><mrow><msub><mi mathvariant="normal">Σ</mi><mi>i</mi></msub><msub><mi>Q</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><msub><mtext>MCS</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\sigma_{l} = \frac{Q_{l}(k + 3)/\text{MCS}_{l}(k)}{\Sigma_{i}Q_{i}(k + 3)/\text{MCS}_{i}(k)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>for all links such that</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>l</mi></msub><msub><mi>T</mi><mtext>total</mtext></msub><mo>&lt;</mo><msub><mi>T</mi><msub><mi>l</mi><mtext>ideal</mtext></msub></msub><mtext> </mtext><msub><mrow><mtext>assign </mtext><msub><mi>T</mi><mi>l</mi></msub><mo>=</mo><msub><mi>T</mi><mrow><msub><mi>l</mi><mtext>ideal</mtext></msub><mtext> </mtext></mrow></msub><mtext>and update </mtext><mi>T</mi></mrow><mtext>total</mtext></msub><mo>=</mo><msub><mi>T</mi><mtext>total</mtext></msub><mo>−</mo><msub><mi>t</mi><mi>l</mi></msub><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">\sigma_{l}T_{\text{total}} &lt; T_{l_{\text{ideal}}}\ {\text{assign}\ T_{l} = T_{l_{\text{ideal}}\ }\text{and\ update\ }T}_{\text{total}} = T_{\text{total}} - t_{l},</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.3056em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3488em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ideal</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2559em"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">assign</span></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3488em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ideal</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em"><span></span></span></span></span></span></span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2559em"><span></span></span></span></span></span></span><span class="mord text"><span class="mord">and update </span></span><span class="mord mathnormal" style="margin-right:0.13889em">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1805em"><span style="top:-2.3944em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3056em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span></span></span></span></span></div><p>until all links have been allocated, or</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>l</mi></msub><msub><mi>T</mi><mtext>total</mtext></msub><mo>≥</mo><msub><mi>T</mi><mrow><msub><mi>l</mi><mtext>ideal</mtext></msub><mtext> </mtext></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">∀</mi><mtext> remaining </mtext><mi>l</mi></mrow><annotation encoding="application/x-tex">\sigma_{l}T_{\text{total}} \geq T_{l_{\text{ideal}}\ },\forall\ \text{remaining\ }l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9503em;vertical-align:-0.2559em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3488em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ideal</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em"><span></span></span></span></span></span></span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2559em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">∀</span><span class="mspace"> </span><span class="mord text"><span class="mord">remaining </span></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span></span></div><p><strong>Step 5.</strong> For all remaining links <em>l</em>, calculate</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>l</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><msub><mtext>MCS</mtext><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><mrow><msub><mi mathvariant="normal">Σ</mi><mi>i</mi></msub><msub><mi>Q</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><msub><mtext>MCS</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\sigma_{l} = \frac{Q_{l}(k + 3)/\text{MCS}_{l}(k)}{\Sigma_{i}Q_{i}(k + 3)/\text{MCS}_{i}(k)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>for all links <em>l</em>, such that</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>l</mi></msub><msub><mi>T</mi><mtext>total</mtext></msub><mo>&gt;</mo><msub><mi>T</mi><mrow><msub><mi>l</mi><mi>max</mi><mo>⁡</mo></msub><mtext> </mtext></mrow></msub><mtext>and </mtext><munderover><mo>∑</mo><mi>i</mi><mrow></mrow></munderover><mfrac><mrow><msub><mi>Q</mi><mi>l</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>3</mn></mrow><mrow><msub><mtext>MCS</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>&gt;</mo><msub><mi>T</mi><mtext>total</mtext></msub></mrow><annotation encoding="application/x-tex">\sigma_{l}T_{\text{total}} &gt; T_{l_{\max}\ }\text{and\ }\sum_{i}^{}\frac{Q_{l}(k + 3}{\text{MCS}_{i}(k)} &gt; T_{\text{total}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.7047em;vertical-align:-1.2777em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em"><span style="top:-2.357em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em"><span></span></span></span></span></span></span><span class="mord text"><span class="mord">and </span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.35em"><span style="top:-1.8723em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">MCS</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mrow><mtext>Assign </mtext><msub><mi>T</mi><mi>l</mi></msub><mo>=</mo><msub><mi>T</mi><msub><mi>l</mi><mi>max</mi><mo>⁡</mo></msub></msub><mo separator="true">,</mo><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext> </mtext><mi>T</mi></mrow><mtext>total</mtext></msub><mo>=</mo><msub><mi>T</mi><mtext>total</mtext></msub><mo>−</mo><msub><mi>t</mi><mi>l</mi></msub><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">{\text{Assign}\ T_{l} = T_{l_{\max}},\ and\ update\ T}_{\text{total}} = T_{\text{total}} - t_{l},</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9942em;vertical-align:-0.2998em"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">Assign</span></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em"><span style="top:-2.357em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.13889em">T</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1863em"><span style="top:-2.4002em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2998em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span></span></span></span></span></div><p>until all links have been allocated, or</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>l</mi></msub><msub><mi>T</mi><mtext>total</mtext></msub><mo>≤</mo><msub><mi>T</mi><mrow><msub><mi>l</mi><mi>max</mi><mo>⁡</mo></msub><mtext> </mtext></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">∀</mi><mtext> remaining </mtext><mi>l</mi></mrow><annotation encoding="application/x-tex">\sigma_{l}T_{\text{total}} \leq T_{l_{\max}\ },\forall\ \text{remaining\ }l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9445em;vertical-align:-0.2501em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em"><span style="top:-2.357em;margin-left:-0.0197em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em"><span></span></span></span></span></span></span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">∀</span><span class="mspace"> </span><span class="mord text"><span class="mord">remaining </span></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span></span></div><p>Then, assign</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mi>l</mi></msub><mo>=</mo><msub><mi>σ</mi><mi>l</mi></msub><msub><mi>T</mi><mtext>total</mtext></msub><mo separator="true">,</mo><mi mathvariant="normal">∀</mi><mtext> remaining </mtext><mi>l</mi></mrow><annotation encoding="application/x-tex">T_{l} = \sigma_{l}T_{\text{total}},\forall\ \text{remaining\ }l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">∀</span><span class="mspace"> </span><span class="mord text"><span class="mord">remaining </span></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span></span></span></span></span></div><p>where allocations are greater than a single slot and where possible, the MAC
combines slots as described in <a href="#mac-phy-spec-slot-timing">Slot Timing</a>, in
order to maximize airtime utilization.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-transfer">Data Transfer<a class="hash-link" href="#data-transfer" title="Direct link to heading">​</a></h3><p>Data transfer between nodes, both uplink and downlink, use the QoS Data frame,
as defined in IEEE 802.11-2016. When a transmit slot arrives and a node has no
data to send, the node transmits the QoS Null Data frame, as defined in IEEE
802.11-2016. The Terragraph MAC uses the aggregated MSDU (A-MSDU) and aggregated
MPDU (A-MPDU) as much as possible, to transmit as much information as possible
in an allocated transmit slot.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="traffic-scheduling">Traffic Scheduling<a class="hash-link" href="#traffic-scheduling" title="Direct link to heading">​</a></h3><p>For traffic scheduling, the Terragraph MAC observes the following priorities for
the transmission of these types of frames:</p><ol><li>ACK and Block ACK frames</li><li>Heartbeat, Keep Alive, and Uplink Bandwidth Request frames</li><li>Management frames</li><li>Data frames</li></ol><p>In slots reserved for beamforming, the MAC transmits only high priority
management frames related to beamforming.</p><p>Terragraph supports QoS for data frames using VPP, as described in the
<a href="/docs/developer/VPP_Implementation#hqos-scheduler-tghqos">TGHQoS section</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ack-and-block-ack-frames">ACK and Block ACK Frames<a class="hash-link" href="#ack-and-block-ack-frames" title="Direct link to heading">​</a></h4><p>The MAC transmits acknowledgement and Block ACK frames during the first
opportunity for transmission during the control slot or any slot allocated to
the link.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="heartbeat-keep-alive-and-uplink-bandwidth-request">Heartbeat, Keep Alive, and Uplink Bandwidth Request<a class="hash-link" href="#heartbeat-keep-alive-and-uplink-bandwidth-request" title="Direct link to heading">​</a></h4><p>The MAC in a DN schedules a Heartbeat frame for transmission at least once
during each BWGD, when there is at least one associated CN. The MAC in a DN
schedules a Keep Alive frame periodically to other associated DNs. The MAC in a
CN schedules the Uplink Bandwidth Request frame for transmission at least once
during each BWGD. The Keep Alive, Heartbeat, and Uplink Bandwidth Request frames
are transmitted in the fixed control slots allocated to each node.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="management-frames-1">Management Frames<a class="hash-link" href="#management-frames-1" title="Direct link to heading">​</a></h4><p>The MAC schedules the transmission of management frames during the first
opportunity for transmission in a control slot or any slot allocated to the
link. Management frames related to beamforming are transmitted only in slots
allocated to beamforming.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-frames-2">Data Frames<a class="hash-link" href="#data-frames-2" title="Direct link to heading">​</a></h4><p>The MAC schedules the transmission of data frames to maximize the use of the
bandwidth allocation for each destination node. The MAC uses the slot(s)
allocated to the link of the destination node that matches the destination
address of the data frame to transmit the frame. The MAC uses the IEEE 802.11
access classes to prioritize the transmission of data frames.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beamforming-1">Beamforming<a class="hash-link" href="#beamforming-1" title="Direct link to heading">​</a></h4><p>When performing asynchronous, synchronous, or periodic beamforming, the MAC
schedules beamforming transmission and reception frames during the first slot of
each transmit and receive subframe, until the beamforming process is completed.</p><p>The MAC indicates to all other associated nodes that these slots are beamforming
slots. More detail on the beamforming procedure can be found in
<a href="/docs/developer/Beamforming_Link_Adaptation">Beamforming and Link Adaptation</a>. In the slots
allocated to beamforming, the MAC transmits only the high priority management
frames, as follows:</p><ol><li><code>urTrnReq</code></li><li><code>urTrnRes</code></li><li><code>urTrnResAck</code></li><li><code>urX</code></li><li>Association Request</li><li>Association Response</li><li>Association Response Acknowledgement</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-adaptation">Link Adaptation<a class="hash-link" href="#link-adaptation" title="Direct link to heading">​</a></h3><p>Link adaptation is the procedure of selecting and adjusting the modulation and
coding scheme (MCS) selected for transmission, to maximize the probability of
successful reception of the transmitted frames.</p><p>The node uses the <code>laFeedbackParams</code> field in the Heartbeat, Keep Alive, and
Uplink Bandwidth Request frames, as well as locally measured parameters, to
perform link adaptation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-measurement">Link Measurement<a class="hash-link" href="#link-measurement" title="Direct link to heading">​</a></h3><p>Link measurement is the process of collecting data on the signal strength and
the signal-to-noise ratio (SNR) of a link, to estimate the path loss of the link
and the link margin at the receiver.</p><p>The node uses the information in the <code>laFeedbackParams</code> field, carried in the
Association Request, Association Response, Association Response ACK, Heartbeat,
Keep Alive, and Uplink Bandwidth Request frames to perform link measurement.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-loss-detection">Link Loss Detection<a class="hash-link" href="#link-loss-detection" title="Direct link to heading">​</a></h3><p>Link loss is the condition where the node determines that communication over an
active link is no longer possible. A node determines link loss based on the loss
of the Heartbeat and Keep Alive frames, or the loss of the Acknowledgement of
the Heartbeat frames.</p><p>A DN determines that a link to another DN is lost when it fails to receive ten
Keep Alive frames in a row. A DN determines that a link to a CN is lost when it
fails to receive Acknowledgement of ten Heartbeat frames in a row.</p><p>A CN determines that a link to a DN is lost when it fails to receive ten
Heartbeat frames in a row. If a CN determines that a link to a previously
connected upstream DN is lost, the CN attempts to regain communication using an
alternative micro-route.</p><p>If regaining communication to an upstream DN is not possible, or if an
alternative micro-route is not available, the CN begins a scanning procedure.</p><p>If communication cannot be regained, the DN sends a Link Status Message of Link
Down to the E2E controller.</p><a id="mac-phy-spec-glossary"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="glossary">Glossary<a class="hash-link" href="#glossary" title="Direct link to heading">​</a></h2><table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody><tr><td>ACK</td><td>Acknowledgement</td></tr><tr><td>AGC</td><td>Automatic gain control</td></tr><tr><td>A-MPDU</td><td>Aggregated MPDU</td></tr><tr><td>A-MSDU</td><td>Aggregated MSDU</td></tr><tr><td>BPSK</td><td>Biphase shift keying</td></tr><tr><td>BWGD</td><td>Bandwidth grant duration</td></tr><tr><td>CN</td><td>Client node</td></tr><tr><td>DBPSK</td><td>Differential biphase shift keying</td></tr><tr><td>DMG</td><td>Directed multi-gigabit</td></tr><tr><td>DN</td><td>Distribution node</td></tr><tr><td>DSCP</td><td>Differentiated Services Code Point</td></tr><tr><td>FCS</td><td>Frame check sequence</td></tr><tr><td>GPS</td><td>Global positioning system</td></tr><tr><td>GNSS</td><td>Global Navigation Satellite System</td></tr><tr><td>IEEE</td><td>Institute of Electrical and Electronic Engineers</td></tr><tr><td>MAC</td><td>Media Access Control</td></tr><tr><td>MCS</td><td>Modulation and coding scheme</td></tr><tr><td>MSDU</td><td>MAC service data unit</td></tr><tr><td>MPDU</td><td>MAC protocol data unit</td></tr><tr><td>OUI</td><td>Organizational unique identifier</td></tr><tr><td>PLCP</td><td>Physical layer convergence procedure</td></tr><tr><td>PHY</td><td>Physical layer</td></tr><tr><td>QAM</td><td>Quadrature amplitude modulation</td></tr><tr><td>QPSK</td><td>Quadrature phase shift keying</td></tr><tr><td>RX</td><td>Receive</td></tr><tr><td>SC</td><td>Single carrier</td></tr><tr><td>SF</td><td>Superframe</td></tr><tr><td>STF</td><td>Short training field</td></tr><tr><td>TDD</td><td>Time division duplex</td></tr><tr><td>TRN</td><td>Training</td></tr><tr><td>TSF</td><td>Time synchronization function</td></tr><tr><td>TX</td><td>Transmit</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/terragraph/meta-terragraph/edit/main/docs/../docs/developer/MAC_PHY_Specification.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developer/Beamforming_Link_Adaptation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Beamforming and Link Adaptation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developer/PHY_Algorithms"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PHY Algorithms</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terragraph-physical-layer" class="table-of-contents__link toc-highlight">Terragraph Physical Layer</a><ul><li><a href="#dmg-control-mode" class="table-of-contents__link toc-highlight">DMG Control Mode</a></li><li><a href="#dmg-single-carrier-phy" class="table-of-contents__link toc-highlight">DMG Single Carrier PHY</a></li><li><a href="#configuration-of-phy-parameters" class="table-of-contents__link toc-highlight">Configuration of PHY Parameters</a></li></ul></li><li><a href="#terragraph-media-access-control-overview" class="table-of-contents__link toc-highlight">Terragraph Media Access Control Overview</a><ul><li><a href="#initiator-and-responder-nodes" class="table-of-contents__link toc-highlight">Initiator and Responder Nodes</a></li><li><a href="#multirate-operation" class="table-of-contents__link toc-highlight">Multirate Operation</a></li></ul></li><li><a href="#terragraph-mac-frame-definitions" class="table-of-contents__link toc-highlight">Terragraph MAC Frame Definitions</a><ul><li><a href="#data-frames-1" class="table-of-contents__link toc-highlight">Data Frames</a></li><li><a href="#a-mpdu-format" class="table-of-contents__link toc-highlight">A-MPDU Format</a></li><li><a href="#control-frames-1" class="table-of-contents__link toc-highlight">Control Frames</a></li><li><a href="#management-message" class="table-of-contents__link toc-highlight">Management Message</a></li></ul></li><li><a href="#channel-access-mechanism" class="table-of-contents__link toc-highlight">Channel Access Mechanism</a><ul><li><a href="#timing-and-tdd-access-mechanism" class="table-of-contents__link toc-highlight">Timing and TDD Access Mechanism</a></li><li><a href="#frames-slots-subframes-and-superframes" class="table-of-contents__link toc-highlight">Frames, Slots, Subframes, and Superframes</a></li><li><a href="#slot-timing" class="table-of-contents__link toc-highlight">Slot Timing</a></li></ul></li><li><a href="#terragraph-mac-procedures" class="table-of-contents__link toc-highlight">Terragraph MAC Procedures</a><ul><li><a href="#frame-aggregation" class="table-of-contents__link toc-highlight">Frame Aggregation</a></li><li><a href="#time-synchronization" class="table-of-contents__link toc-highlight">Time Synchronization</a></li><li><a href="#frame-synchronization" class="table-of-contents__link toc-highlight">Frame Synchronization</a></li><li><a href="#scanning" class="table-of-contents__link toc-highlight">Scanning</a></li><li><a href="#beamforming" class="table-of-contents__link toc-highlight">Beamforming</a></li><li><a href="#association" class="table-of-contents__link toc-highlight">Association</a></li><li><a href="#block-acknowledgement" class="table-of-contents__link toc-highlight">Block acknowledgement</a></li><li><a href="#management-frame-transmission" class="table-of-contents__link toc-highlight">Management Frame Transmission</a></li><li><a href="#simple-acknowledgement" class="table-of-contents__link toc-highlight">Simple Acknowledgement</a></li><li><a href="#retransmission" class="table-of-contents__link toc-highlight">Retransmission</a></li><li><a href="#bandwidth-allocation" class="table-of-contents__link toc-highlight">Bandwidth Allocation</a></li><li><a href="#data-transfer" class="table-of-contents__link toc-highlight">Data Transfer</a></li><li><a href="#traffic-scheduling" class="table-of-contents__link toc-highlight">Traffic Scheduling</a></li><li><a href="#link-adaptation" class="table-of-contents__link toc-highlight">Link Adaptation</a></li><li><a href="#link-measurement" class="table-of-contents__link toc-highlight">Link Measurement</a></li><li><a href="#link-loss-detection" class="table-of-contents__link toc-highlight">Link Loss Detection</a></li></ul></li><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Terragraph</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/runbook/Overview">Overview</a></li><li class="footer__item"><a href="https://www.facebook.com/connectivity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meta Connectivity<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/terragraph" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/HQaxCevzus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ee1b3ecd.js"></script>
<script src="/assets/js/main.feb34f19.js"></script>
</body>
</html>